<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Jan Verbesselt, Jorge Mendes de Jesus, Aldo Bergsma, Dainius Masiliunas" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
  
  <!-- bootstrap -->
  <!--<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet"  id="style">-->
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  
  <!-- highlight.js -->
  <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css" rel="stylesheet" id="code-style">-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
  <script>
  hljs.LANGUAGES.r=function(a){var b="([a-zA-Z]|\\.[a-zA-Z.])[a-zA-Z0-9._]*";return{c:[a.HCM,{b:b,l:b,k:{keyword:"function if in break next repeat else for return switch while try tryCatch|10 stop warning require library attach detach source setMethod setGeneric setGroupGeneric setClass ...|10",literal:"NULL NA TRUE FALSE T F Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10"},r:0},{cN:"number",b:"0[xX][0-9a-fA-F]+[Li]?\\b",r:0},{cN:"number",b:"\\d+(?:[eE][+\\-]?\\d*)?L\\b",r:0},{cN:"number",b:"\\d+\\.(?!\\d)(?:i\\b)?",r:0},{cN:"number",b:"\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[a.BE],r:0},{cN:"string",b:"'",e:"'",c:[a.BE],r:0}]}}(hljs); </script>
  <!--<script type="text/javascript", src="https://yandex.st/highlightjs/7.3/languages/r.min.js"></script>-->
  
  <!-- Manific Popup -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/0.8.9/jquery.magnific-popup.min.js"></script>
  
  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script defer="defer">
  // Function to generate the dynamic table of contents
  jQuery.fn.generate_TOC = function () {
    var base = $(this[0]);
  
    var selectors = ['h1', 'h2', 'h3', 'h4'];
  
    var last_ptr = [{}, {}, {}, {}];
  
    var anchors = {};
  
    generate_anchor = function (text) {
      var test = text.replace(/\W/g, '_');
  
      while(test in anchors){
        //if no suffix, add one
        if(test.match(/_\d+$/) === null){
          test = test + "_2";
        }
        //else generate unique id for duplicates by adding one to the suffix
        else {
          test = test.replace(/_(\d+)$/, function(match, number){ var num=+number+1; return("_" + num) });
        }
      }
      anchors[test]=1;
      return(test);
    }
  
    $(selectors.join(',')).filter(function(index) { return $(this).parent().attr("id") != 'header'; }).each(function () {
  
      var heading = $(this);
      var idx = selectors.indexOf(heading.prop('tagName').toLowerCase());
      var itr = 0;
  
      while (itr <= idx) {
        if (jQuery.isEmptyObject(last_ptr[itr])) {
          last_ptr[itr] = $('<ul>').addClass('nav');
          if (itr === 0) {
            base.append(last_ptr[itr])
          } else {
            if(last_ptr[itr-1].children('li').length === 0){
              last_ptr[itr-1].append(last_ptr[itr]);
            }
            else {
              last_ptr[itr - 1].children('li').last().append(last_ptr[itr]);
            }
          }
        }
        itr++;
      }
      var anchor = generate_anchor(heading.text());
      heading.attr('id', anchor);
      var a = $('<a>')
      .text(heading.text())
      .attr('href', '#' + anchor);
  
    var li = $('<li>')
      .append(a);
  
    last_ptr[idx].append(li);
    for (i = idx + 1; i < last_ptr.length; i++) {
      last_ptr[i] = {};
    }
    });
  }
  /* run scripts when document is ready */
  $(function() {
    "use strict";
  
    var $window = $(window);
    var $body = $(document.body);
  
    /* size of thumbnails */
  
    var hidden_types = ['source']
    var output_types = ['output', 'message', 'warning', 'error']
  
    /* style tables */
    $('table').addClass('table table-striped table-bordered table-hover table-condensed');
  
    $('pre code').each(function(i, e) {
      hljs.highlightBlock(e);
    });
  
    /* Magnific Popup */
    $(".thumbnail").each(function(){
      $(this).magnificPopup({
        disableOn: 768,
        closeOnContentClick: true,
  
        type: 'image',
        items: {
          src: $(this).find('img').attr('src'),
        }
      });
    });
  
    function toggle_block(obj, show) {
      var span = obj.find('span');
      if(show === true){
        span.removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
        obj.next('pre').slideDown();
      }
      else {
        span.removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
        obj.next('pre').slideUp();
      }
    }
  
    function toggle_thumbnails(imgs, show){
      if(show === true){
        imgs.parents().show()
        imgs.slideDown();
      }
      else {
        imgs.slideUp(400, function(){ $(this).parent().hide(); });
      }
    }
  
    function global_toggle(obj){
      var type = obj.attr('type');
      var show = !obj.parent('li').hasClass('active');
      if(show === true){
        obj.parent('li').addClass('active');
      }
      else{
        obj.parent('li').removeClass('active');
      }
      if(type == 'figure'){
        toggle_thumbnails($('.thumbnail img'), show);
      }
      else {
        $('.toggle.' + type).each(function() { toggle_block($(this), show); });
      }
    }
  
    /* onclick toggle next code block */
    $('.toggle').click(function() {
      var span = $(this).find('span');
      toggle_block($(this), !span.hasClass('glyphicon-chevron-down'));
      return false
    })
  
    // global toggles
    $('.toggle-global').click(function(){
      var type = $(this).attr('type');
      if(type === 'all-source'){
          $('li a.source').each(function() {
            global_toggle($(this));
          });
        }
      else if(type === 'all-output'){
        $.each(output_types, function(i, val){
          console.log(val);
          global_toggle($('li a.' + val));
        });
      }
      else {
        console.log($(this));
        global_toggle($(this));
      }
      return false;
    });
    /* table of contents */
    if($(['h1', 'h2', 'h3', 'h4'].join(',')).length > 0){
      $('body > #wrap > .container > .row').append('<div class="col-md-2"><div id="toc" class="well sidebar sidenav affix hidden-print"/></div>');
      $('#toc').generate_TOC();
    }
  
    $.each(hidden_types, function(i, type) {
      $('li[type=' + type + ']').each(function(){ global_toggle($(this)); });
    });
  
    /* remove paragraphs with no content */
    $('p:empty').remove();
  
    $body.scrollspy({
      target: '.sidebar',
    });
  
    /* theme switch */
    $('.theme-switch').click(function(){
      var css = $('link[title=' + $(this).attr('title') + ']');
      $('#theme[rel=stylesheet]').attr('href', css.attr('href'));
      $('.theme-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });
    /* code style switch */ //TODO use same function for both of these?
    $('.highlight-switch').click(function(){
      var css = $('link[title="' + $(this).attr('title') + '"]');
      $('#highlight[rel=stylesheet]').attr('href', css.attr('href'));
      $('.highlight-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });
  
    //TODO refresh on show/hide
    $window.on('load', function () {
      $body.scrollspy('refresh');
    })
  
  });
  
  </script>
  <style>
  /* Knitr_bootstrap styles */
  #header {
    display: none !important;
    visibility: hidden !important;
  }
  #wrap .container-fluid {
    padding: 0;
    overflow: hidden;
  }
  .toggle{
    text-transform: capitalize;
  }
  
  .toggle-global{
    text-transform: capitalize;
  }
  
  /* Sticky footer styles */
  * {
    margin:0;
  }
  html,
  body {
      height: 100%;
      padding:0 !important;
      /* The html and body elements cannot have any padding or margin. */
      /*overflow-x: hidden;*/
  }
  
  /* Wrapper for page content to push down footer */
  #wrap {
      min-height: 100%;
      height: auto !important;
      height: 100%;
      /* Negative indent footer by it's height */
      margin: 0 auto -120px;
  }
  
  /* Set the fixed height of the footer here */
  #push,
  #footer {
      height: 120px;
  }
  
  #footer {
    text-align: center;
  }
  
  /* Top level subheader elements.  These are the first nested items underneath a header element. */
  .header li {
    font-size: 20px;
  }
  
  /* Makes the font smaller for all subheader elements. */
  .sub-header li {
      font-size: 12px;
  }
  
  button.thumbnails {
    margin-left:0px;
  }
  
  /*
   * Side navigation
   *
   * Scrollspy and affixed enhanced navigation to highlight sections and secondary
   * sections of docs content.
   */
  
  /* By default it's not affixed in mobile views, so undo that */
  .sidebar.affix {
    position: static;
  }
  
  /* First level of nav */
  .sidenav {
    margin-top: 30px;
    margin-bottom: 30px;
    padding-top:    10px;
    padding-bottom: 10px;
    border-radius: 5px;
  }
  
  /* All levels of nav */
  .sidebar .nav > li > a {
    display: block;
    padding: 5px 20px;
  }
  .sidebar .nav > li > a:hover,
  .sidebar .nav > li > a:focus {
    text-decoration: none;
    border-right: 1px solid;
  }
  .sidebar .nav > .active > a,
  .sidebar .nav > .active:hover > a,
  .sidebar .nav > .active:focus > a {
    font-weight: bold;
    background-color: transparent;
    border-right: 1px solid;
  }
  
  /* Nav: second level (shown on .active) */
  .sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    margin-bottom: 8px;
  }
  .sidebar .nav .nav > li > a {
    padding-top:    3px;
    padding-bottom: 3px;
    padding-left: 30px;
    font-size: 90%;
  }
  
  .sidebar .nav .nav .nav > li > a {
    padding-left: 40px;
  }
  .sidebar .nav .nav .nav .nav > li > a {
    padding-left: 50px;
  }
  
  /* Show and affix the side nav when space allows it */
  @media screen and (min-width: 992px) {
    .sidebar .nav > .active > ul {
      display: block;
    }
    /* Widen the fixed sidebar */
    .sidebar.affix,
    .sidebar.affix-bottom {
      width: 213px;
    }
    .sidebar.affix-top,
    .sidebar.affix {
      position: fixed; /* Undo the static from mobile first approach */
      top: 30px;
    }
    .sidebar.affix-bottom {
      position: absolute; /* Undo the static from mobile first approach */
    }
    .sidebar.affix-bottom .sidenav,
    .sidebar.affix .sidenav {
      margin-top: 0;
      margin-bottom: 0;
    }
  }
  @media screen and (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .sidebar.affix-bottom,
    .sidebar.affix {
      width: 263px;
    }
  }
  
  #toc {
    padding: 10px 0px;
    margin:0;
    border:0;
  }
  
  
  .panel pre {
    margin: 0;
    padding: 0;
    border: 0;
  }
  button + pre {
    margin: 0;
    padding: 0;
  }
  pre code {
    border-radius: 0;
  }
  /* Magnific Popup CSS */
  .mfp-bg {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1042;
    overflow: hidden;
    position: fixed;
    background: #0b0b0b;
    opacity: 0.8;
    filter: alpha(opacity=80); }
  
  .mfp-wrap {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1043;
    position: fixed;
    outline: none !important;
    -webkit-backface-visibility: hidden; }
  
  .mfp-container {
    text-align: center;
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
    padding: 0 8px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box; }
  
  .mfp-container:before {
    content: '';
    display: inline-block;
    height: 100%;
    vertical-align: middle; }
  
  .mfp-align-top .mfp-container:before {
    display: none; }
  
  .mfp-content {
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin: 0 auto;
    text-align: left;
    z-index: 1045; }
  
  .mfp-inline-holder .mfp-content,
  .mfp-ajax-holder .mfp-content {
    width: 100%;
    cursor: auto; }
  
  .mfp-ajax-cur {
    cursor: progress; }
  
  .mfp-zoom-out-cur,
  .mfp-zoom-out-cur .mfp-image-holder .mfp-close {
    cursor: -moz-zoom-out;
    cursor: -webkit-zoom-out;
    cursor: zoom-out; }
  
  .mfp-zoom {
    cursor: pointer;
    cursor: -webkit-zoom-in;
    cursor: -moz-zoom-in;
    cursor: zoom-in; }
  
  .mfp-auto-cursor .mfp-content {
    cursor: auto; }
  
  .mfp-close,
  .mfp-arrow,
  .mfp-preloader,
  .mfp-counter {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none; }
  
  .mfp-loading.mfp-figure {
    display: none; }
  
  .mfp-hide {
    display: none !important; }
  
  .mfp-preloader {
    color: #cccccc;
    position: absolute;
    top: 50%;
    width: auto;
    text-align: center;
    margin-top: -0.8em;
    left: 8px;
    right: 8px;
    z-index: 1044; }
  
  .mfp-preloader a {
    color: #cccccc; }
  
  .mfp-preloader a:hover {
    color: white; }
  
  .mfp-s-ready .mfp-preloader {
    display: none; }
  
  .mfp-s-error .mfp-content {
    display: none; }
  
  button.mfp-close,
  button.mfp-arrow {
    overflow: visible;
    cursor: pointer;
    background: transparent;
    border: 0;
    -webkit-appearance: none;
    display: block;
    padding: 0;
    z-index: 1046;
    -webkit-box-shadow: none;
    box-shadow: none; }
  
  button::-moz-focus-inner {
    padding: 0;
    border: 0; }
  
  .mfp-close {
    width: 44px;
    height: 44px;
    line-height: 44px;
    position: absolute;
    right: 0;
    top: 0;
    text-decoration: none;
    text-align: center;
    opacity: 0.65;
    padding: 0 0 18px 10px;
    color: white;
    font-style: normal;
    font-size: 28px;
    font-family: Arial, Baskerville, monospace; }
    .mfp-close:hover, .mfp-close:focus {
      opacity: 1; }
    .mfp-close:active {
      top: 1px; }
  
  .mfp-close-btn-in .mfp-close {
    color: #333333; }
  
  .mfp-image-holder .mfp-close,
  .mfp-iframe-holder .mfp-close {
    color: white;
    right: -6px;
    text-align: right;
    padding-right: 6px;
    width: 100%; }
  
  .mfp-counter {
    position: absolute;
    top: 0;
    right: 0;
    color: #cccccc;
    font-size: 12px;
    line-height: 18px; }
  
  .mfp-arrow {
    position: absolute;
    opacity: 0.65;
    margin: 0;
    top: 50%;
    margin-top: -55px;
    padding: 0;
    width: 90px;
    height: 110px;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }
  
  .mfp-arrow:active {
    margin-top: -54px; }
  
  .mfp-arrow:hover,
  .mfp-arrow:focus {
    opacity: 1; }
  
  .mfp-arrow:before, .mfp-arrow:after,
  .mfp-arrow .mfp-b,
  .mfp-arrow .mfp-a {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    left: 0;
    top: 0;
    margin-top: 35px;
    margin-left: 35px;
    border: medium inset transparent; }
  .mfp-arrow:after,
  .mfp-arrow .mfp-a {
    border-top-width: 13px;
    border-bottom-width: 13px;
    top: 8px; }
  .mfp-arrow:before,
  .mfp-arrow .mfp-b {
    border-top-width: 21px;
    border-bottom-width: 21px; }
  
  .mfp-arrow-left {
    left: 0; }
    .mfp-arrow-left:after,
    .mfp-arrow-left .mfp-a {
      border-right: 17px solid white;
      margin-left: 31px; }
    .mfp-arrow-left:before,
    .mfp-arrow-left .mfp-b {
      margin-left: 25px;
      border-right: 27px solid #3f3f3f; }
  
  .mfp-arrow-right {
    right: 0; }
    .mfp-arrow-right:after,
    .mfp-arrow-right .mfp-a {
      border-left: 17px solid white;
      margin-left: 39px; }
    .mfp-arrow-right:before,
    .mfp-arrow-right .mfp-b {
      border-left: 27px solid #3f3f3f; }
  
  .mfp-iframe-holder {
    padding-top: 40px;
    padding-bottom: 40px; }
  
  .mfp-iframe-holder .mfp-content {
    line-height: 0;
    width: 100%;
    max-width: 900px; }
  
  .mfp-iframe-scaler {
    width: 100%;
    height: 0;
    overflow: hidden;
    padding-top: 56.25%; }
  
  .mfp-iframe-scaler iframe {
    position: absolute;
    display: block;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: black; }
  
  .mfp-iframe-holder .mfp-close {
    top: -40px; }
  
  /* Main image in popup */
  img.mfp-img {
    width: auto;
    max-width: 100%;
    height: auto;
    display: block;
    line-height: 0;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    padding: 40px 0 40px;
    margin: 0 auto; }
  
  /* The shadow behind the image */
  .mfp-figure:after {
    content: '';
    position: absolute;
    left: 0;
    top: 40px;
    bottom: 40px;
    display: block;
    right: 0;
    width: auto;
    height: auto;
    z-index: -1;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: #444444; }
  
  .mfp-figure {
    line-height: 0; }
  
  .mfp-bottom-bar {
    margin-top: -36px;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    cursor: auto; }
  
  .mfp-title {
    text-align: left;
    line-height: 18px;
    color: #f3f3f3;
    word-wrap: break-word;
    padding-right: 36px; }
  
  .mfp-figure small {
    color: #bdbdbd;
    display: block;
    font-size: 12px;
    line-height: 14px; }
  
  .mfp-image-holder .mfp-content {
    max-width: 100%; }
  
  .mfp-gallery .mfp-image-holder .mfp-figure {
    cursor: pointer; }
  
  @media screen and (max-width: 800px) and (orientation: landscape), screen and (max-height: 300px) {
    /**
     * Remove all paddings around the image on small screen
     */
    .mfp-img-mobile .mfp-image-holder {
      padding-left: 0;
      padding-right: 0; }
  
    .mfp-img-mobile img.mfp-img {
      padding: 0; }
  
    /* The shadow behind the image */
    .mfp-img-mobile .mfp-figure:after {
      top: 0;
      bottom: 0; }
  
    .mfp-img-mobile .mfp-bottom-bar {
      background: rgba(0, 0, 0, 0.6);
      bottom: 0;
      margin: 0;
      top: auto;
      padding: 3px 5px;
      position: fixed;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box; }
  
    .mfp-img-mobile .mfp-bottom-bar:empty {
      padding: 0; }
  
    .mfp-img-mobile .mfp-counter {
      right: 5px;
      top: 3px; }
  
    .mfp-img-mobile .mfp-close {
      top: 0;
      right: 0;
      width: 35px;
      height: 35px;
      line-height: 35px;
      background: rgba(0, 0, 0, 0.6);
      position: fixed;
      text-align: center;
      padding: 0; }
  
    .mfp-img-mobile .mfp-figure small {
      display: inline;
      margin-left: 5px; } }
  @media all and (max-width: 900px) {
    .mfp-arrow {
      -webkit-transform: scale(0.75);
      transform: scale(0.75); }
  
    .mfp-arrow-left {
      -webkit-transform-origin: 0;
      transform-origin: 0; }
  
    .mfp-arrow-right {
      -webkit-transform-origin: 100%;
      transform-origin: 100%; }
  
    .mfp-container {
      padding-left: 6px;
      padding-right: 6px; } }
  .mfp-ie7 .mfp-img {
    padding: 0; }
  .mfp-ie7 .mfp-bottom-bar {
    width: 600px;
    left: 50%;
    margin-left: -300px;
    margin-top: 5px;
    padding-bottom: 5px; }
  .mfp-ie7 .mfp-container {
    padding: 0; }
  .mfp-ie7 .mfp-content {
    padding-top: 44px; }
  .mfp-ie7 .mfp-close {
    top: 0;
    right: 0;
    padding-top: 0; }
  
  //Magnific overrides
  .mfp-image img{
    background: white;
  }
  .mfp-figure:after {
    background: white;
  }
  
  /*
   * Off Canvas navbar toggle right
   * --------------------------------------------------
   */
  
  @media screen and (max-width: 768px) {
    .row-offcanvas .collapsing {
    -webkit-transition: none 0;
      -moz-transition: none 0;
      transition: none 0;
    }
   .row-offcanvas .navbar {
    position: absolute;
    z-index: 2;
      right:0;
      height:100%;
      width:55px;
      border:0;
      background-color:transparent;
    }
    .row-offcanvas .navbar-toggle {
      margin-right: 5px;
      margin-left: 5px;
    }
    .row-offcanvas {
      position: relative;
    }
    .row-offcanvas-right.active .navbar {
    position: absolute;
    z-index: 2;
      right: -28.4%;
      width:40%;
      background-color:#eee;
      border:0 solid #ddd;
      border-left-width:1px;
    }
    .row-offcanvas-right.active {
      left: -30%;
    }
    .row-offcanvas-right.active .navbar-collapse {
      position: relative;
      width: 100%;
    }
    .row-offcanvas .content {
    /*width:calc(100% - 60px);*/
    }
  }
  </style>
</head>
<body>
<title>
Week 3: Python for geo-scripting
</title>
<div id="wrap">
<div class="container">
<div class="row row-offcanvas row-offcanvas-right">
<div class="contents col-xs-12 col-md-10">
<h1 id="wur-geoscripting"><a href="https://geoscripting-wur.github.io/">WUR Geoscripting</a> <img src="http://www.wur.nl/upload/b43b7095-e452-482a-8969-fed9a50393a8_WUR_RGB_standard.png" alt="WUR logo" style="height: 35px;"/></h1>
<h1 id="vector-data-handling-with-python">Vector data handling with Python</h1>
<p><em>Jan Verbesselt, Jorge Mendes de Jesus, Aldo Bergsma, Dainius Masiliunas, David Swinkels, Corné Vreugdenhil</em> - 22 November, 2019</p>
<h2 id="introduction">Introduction</h2>
<p>Good morning! Today we will have fun by exploring a variety of Python packages for vector data handling. A good package is <a href="http://geopandas.org/">GeoPandas</a>. GeoPandas strives to make vector processing in Python easier and has a lot of tools available for exploratory vector data analysis. It leverages several other popular Python packages:</p>
<ul>
<li><a href="http://pandas.pydata.org/">Pandas</a> for dataframes and data analysis</li>
<li><a href="http://toblerity.org/shapely/">Shapely</a> for geometric operations</li>
<li><a href="http://toblerity.org/fiona/">Fiona</a> for geodata access and conversions</li>
<li><a href="https://github.com/jswhit/pyproj">pyproj</a> for re-projecting</li>
<li><a href="https://matplotlib.org/">matplotlib</a> for plotting</li>
<li><a href="https://pypi.org/project/psycopg2/">psycopg2</a> for PostgreSQL database connection</li>
<li><a href="https://geopy.readthedocs.io/en/stable/">GeoPy</a> for geocoding</li>
</ul>
<p>By bundling the tools of these packages, GeoPandas provides powerful tools to perform spatial analysis in Python. Other packages, such as <a href="https://python-visualization.github.io/folium/docs-v0.6.0/">Folium</a> and <a href="https://osmnx.readthedocs.io/en/stable/">OSMnx</a>, build on the GeoDataFrame capablities of GeoPandas. Fiona builds on GDAL/OGR packages to read and write data. GDAL/OGR/OSR are the backbone of spatial processing in Python and have high performance, but are not that intuitive to use. GeoPandas made it easier to perform spatial processing.</p>
<h2 id="setting-up-the-python-environment">Setting up the Python Environment</h2>
<p>Before we continue with scripting, the Python environment needs to be setup. Let's use Conda for this. Check in Bash what environments are already available.</p>
<div class="row">
<button class="source bash toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> bash source
</button>
<pre style=""><code class="source bash">conda info --envs</code></pre>
</div>
<p>We won't use the existing environment, but it is a good practice to be aware of all available conda environments. Now create a new conda environment for today called vectorpython and install the required packages.</p>
<div class="row">
<button class="source bash toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> bash source
</button>
<pre style=""><code class="source bash">conda create --name VectorPython python=3 geopandas spyder owslib kealib jupyter matplotlib seaborn pyproj owslib -y
source activate VectorPython
conda install --channel conda-forge folium geopy osmnx -y
pip install fiona=1.8.8 -y</code></pre>
</div>
<p>Most of the installed software were Python packages. One was not. Can you tell which one?</p>
<p>It was the <a href="https://docs.spyder-ide.org/">Spyder IDE</a>! Run the bash code below to setup your file system and to start Spyder. When Spyder is started in a terminal with an active conda environment, Spyder automatically uses the Python interpreter of the active conda environment. Make a new directory for your main script, other scripts and data with some bash code. Then start Spyder.</p>
<div class="row">
<button class="source bash toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> bash source
</button>
<pre style=""><code class="source bash">cd ~/Documents/
mkdir PythonVector #or give the directory a name to your liking
cd ./PythonVector
mkdir scripts
mkdir data
spyder</code></pre>
</div>
<p>In Spyder you should see an editor, a file explorer and a console. Have a look at the toolbar. Some important shortcuts are:</p>
<ul>
<li>F5 to run your script</li>
<li>CTRL + S to save your script</li>
<li>CTRL + 1 to comment/uncomment your code</li>
<li>TAB to indent your code</li>
<li>SHIFT + TAB to unindent your code</li>
</ul>
<p>Open a new file and save your Python script in the main directory you just made and name it main.py (File -- &gt; New File --&gt; Save As).</p>
<h2 id="creating-geometries-geoseries-and-geodataframes">Creating Geometries, GeoSeries and GeoDataFrames</h2>
<p>Geometries in Python can be created and stored as a datatype by using Shapely. Shapely can create geometries and performs geometric operations. GeoPandas uses the geometries from Shapely to store geometries in GeoSeries and GeoDataFrames. Copy the code below in the Spyder Editor and press run (F5):</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from shapely.geometry import Point
import geopandas as gpd
wageningenCampus = Point([173994.1578792833, 444133.60329471016])
print(type(wageningenCampus))
gs = gpd.GeoSeries([wageningenCampus])
print(type(gs), len(gs))</code></pre>
</div>
<p>You just created a point in Shapely and a GeoSeries in GeoPandas. A GeoSeries is a vector (a column of values) where each value in the vector is a set of shapes corresponding to one observation. GeoPandas implements two main data structures, a GeoSeries and a GeoDataFrame. If you are familiar with Pandas, then know that these are subclasses of Pandas Series and DataFrame, respectively.</p>
<p>A GeoSeries is made up of an index and a GeoPandas geometry data type. This data type is a shapely.geometry object, and therefore inherits attributes and methods from shapely geometries, such as area, bounds, distance, etc. A GeoDataFrame is a tabular data structure with multiple columns that contains one column that is a GeoSeries.</p>
<p>GeoPandas has six classes of geometric objects, corresponding to the three basic single-entity geometric types and their associated homogeneous collections of multiple entities:</p>
<ul>
<li>Single entity (core, basic types):
<ul>
<li>Point</li>
<li>Line (formally known as a LineString)</li>
<li>Polygon</li>
</ul></li>
<li>Homogeneous entity collections:
<ul>
<li>Multi-Point</li>
<li>Multi-Line (MultiLineString)</li>
<li>Multi-Polygon</li>
</ul></li>
</ul>
<p>The geometries are represented in WKT strings. WKT (<a href="https://en.wikipedia.org/wiki/Well-known_text">Well Known Text</a>) is a markup language that describes spatial information in a clean text format, there is an equivalent in binary format called WKB (easier for computers to process and more efficient for data transfer). Printing geometries of GeoSeries also shows the WKT string.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from shapely.wkt import loads
WKTstring = 'POINT(173994.1578792833 444133.6032947102)'
gs = gpd.GeoSeries([loads(WKTstring)])
gs.crs = {'init': 'epsg:28992'}
gsBuffer = gs.buffer(100)
print(gs.geometry)
print(gsBuffer.geometry)</code></pre>
</div>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 1</strong>: What does WKB mean? (hint: think about WKT)
</p>
</blockquote>
</div>
</div>
<p>GeoDataFrames can be loaded from a file, created with data or loaded from a Pandas dataframe. A Pandas DataFrame is the dataframe equivalent of R in Python.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import pandas as pd
data = {'name': ['a', 'b', 'c'],
        'x': [173994.1578792833, 173974.1578792833, 173910.1578792833],
        'y': [444135.6032947102, 444186.6032947102, 444111.6032947102]}
df = pd.DataFrame(data)
print(df.head)</code></pre>
</div>
<p>If a Pandas dataframe has two columns filled with coordinate pairs, then these columns can be converted to a list of Point geometries and can then be converted into a GeoSeries or directly to a GeoDataFrame.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">geometry = [Point(xy) for xy in zip(df['x'], df['y'])]
wageningenGDF = gpd.GeoDataFrame(df, geometry=geometry)
wageningenGDF.crs = {'init': 'epsg:28992'}
wageningenGDF.plot(marker='*', color='green', markersize=50)
print(type(wageningenGDF), len(wageningenGDF))</code></pre>
</div>
<p><img src="./images/wageningenGDF.png" alt="Landmarks in Wageningen", width = "60%"></p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 2</strong>: What is the difference between a GeoSeries and a GeoDataFrame?
</p>
</blockquote>
</div>
</div>
<h2 id="geocoding">Geocoding</h2>
<p>Geocoding is the practice of locating the coordinates of addresses, cities, countries, and landmarks across the globe. Python has GeoPy to perform geocoding. GeoPy has a lot of <a href="https://geopy.readthedocs.io/en/stable/">geocoders available</a> from Bing, Google, HERE, TomTom, MapBox and others. Often you need to have an API key to use the geocoders, which is used by the provider to limit the amount of requests to be able to keep the geocoding service running for everyone. Some geocoders are publicly available, such as Nominatim. Nominatim is made and used by OpenStreetMap. Paste the code below in Spyder and run the geocoder:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from geopy.geocoders import Nominatim
geolocator = Nominatim(user_agent="specify_random_user_agent")
location = geolocator.geocode("Wageningen University")
print((location.latitude, location.longitude))
# It should print two coordinates: (lat: 51.98527485, lon:5.66370505205543)</code></pre>
</div>
<p>Try to locate the coordinates of your own house.</p>
<h2 id="re-projecting">Re-projecting</h2>
<p>From the geocoder you got a latitude and longitude. On the web it is very common to use latitude and longitude in <a href="http://spatialreference.org/ref/epsg/wgs-84">WGS84 geographic coordinate system</a>. In local projects often projected coordinate systems are required to perform accurate geometric calculations. PyProj reprojects your coordinates from any input projection to an output projection. Use PyProj to do a simple conversion on a coordinate pair:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from pyproj import Proj, transform
geolocator = Nominatim(user_agent="specify_random_user_agent")
location = geolocator.geocode("Wageningen University")
inProj = Proj(init='epsg:4326') #WGS84
outProj = Proj(init='epsg:28992') #RD New
x, y = transform(inProj, outProj, location.longitude, location.latitude)
print([x, y])</code></pre>
</div>
<p>GeoPandas uses PyProj on the backend to reproject geometry columns of the dataframe. Reproject your GeoDataFrame from Dutch RD New (EPSG:28992) to WGS84 (EPSG:4326):</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">data = {'name': ['a', 'b', 'c'],
        'x': [173994.1578792833, 173974.1578792833, 173910.1578792833],
        'y': [444135.6032947102, 444186.6032947102, 444111.6032947102]}
df = pd.DataFrame(data)
geometry = [Point(xy) for xy in zip(df['x'], df['y'])]
wageningenGDF = gpd.GeoDataFrame(df, geometry=geometry)
print(wageningenGDF.crs)
wageningenGDF.crs = {'init': 'epsg:28992'}
print(wageningenGDF.crs)
wageningenGDF = wageningenGDF.to_crs({'init': 'epsg:4326'})
print(wageningenGDF.crs)</code></pre>
</div>
<h2 id="writing-and-reading-files">Writing and Reading Files</h2>
<p>GeoPandas uses Fiona for file access. You can find out what file formats Fiona supports with a simple script.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import fiona
print(fiona.supported_drivers)</code></pre>
</div>
<p>Fiona has drivers for:</p>
<ul>
<li>Open formats such as GeoJSON and GPX</li>
<li>ESRI formats such as shapefiles and OpenFileGDB</li>
<li>Other formats such as MapInfo and DGN</li>
</ul>
<p>But Fiona lacks some other popular file formats:</p>
<ul>
<li>Open formats such as <a href="https://github.com/Toblerity/Fiona/issues/97">KML</a> or <a href="https://github.com/Toblerity/Fiona/pull/96">GML</a> based on the XML format. Solution: <a href="https://docs.python.org/3/library/xml.etree.elementtree.html">xml.etree.ElementTree</a>.</li>
<li>Databases such as PostgreSQL. Solution: <a href="https://pypi.org/project/psycopg2/">psycopg2</a>.</li>
<li>Webservices such as Web Feature Service [WFS] or Web Map Service [WMS]. Solution: <a href="https://geopython.github.io/OWSLib/">OWSLib</a>.</li>
<li>Columnar formats, such as CSV or xls. Solution: Pandas can read <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">csv</a> or <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_excel.html">excel</a> columns.</li>
</ul>
<p>If none of these packages are helpful to access your files, <a href="http://www.gdal.org/ogr_formats.html">OGR might still be able to help</a>.</p>
<p>A GeoDataFrame can be written directly to a GeoJSON file or a shapefile. <a href="http://switchfromshapefile.org/">GeoJSON is a recommended format</a> to use for geographic data in WGS84 coordinate system since JSON dictionaries are easy to read and use on the web, and GeoJSON is supported in popular GIS software. <a href="http://geojson.org/">GeoJSON</a> is a standard format to encode Geographic data structures in a dictionary. We assume that you are working in the main repository in which you have a data repository. Write some files to a GeoJSON and shapefile:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">data = {'name': ['a', 'b', 'c'],
        'x': [173994.1578792833, 173974.1578792833, 173910.1578792833],
        'y': [444135.6032947102, 444186.6032947102, 444111.6032947102]}
df = pd.DataFrame(data)
geometry = [Point(xy) for xy in zip(df['x'], df['y'])]
wageningenGDF = gpd.GeoDataFrame(df, geometry=geometry)
wageningenGDF.to_file(filename='./data/wageningenPOI.geojson', driver='GeoJSON')
wageningenGDF.to_file(filename='./data/wageningenPOI.shp', driver='ESRI Shapefile')</code></pre>
</div>
<p>Reading files is just as intuitive:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">jsonGDF = gpd.read_file('./data/wageningenPOI.geojson')
shpGDF = gpd.read_file('./data/wageningenPOI.shp')</code></pre>
</div>
<h2 id="reading-from-web-services">Reading from Web Services</h2>
<p>The web has a lot of geodata available. The OpenGeoSpatial Consortium has specified standard protocols for geo web services, such as <a href="http://www.opengeospatial.org/standards/wfs">Web Feature Service</a> [WFS] and <a href="http://www.opengeospatial.org/standards/wms">Web Map Service</a> [WMS]. The standard web service protocols make it easy to access all types of data with the same protocol.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from owslib.wfs import WebFeatureService
WfsUrl = 'https://geodata.nationaalgeoregister.nl/nwbwegen/wfs?'
wfs = WebFeatureService(url=WfsUrl, version='2.0.0')
wfs.identification.title
print(list(wfs.contents))</code></pre>
</div>
<p>This WFS provides geodata on roads and is extracted from the Dutch national database of roads in the Netherlands.</p>
<p>WFS are useful to make webmaps, to quickly get an idea of the data and to make geodata accessible for all. If you want to do a large analysis, it is better to download the geodata from other available repositories and not from a WFS. Web Feature Services have limits on the amount of features that can be requested, such as 100 or 1000 features. In this case they are very generous with providing a limit of max 15.000 features per request.</p>
<p>Load some roads from the WFS service for the campus area and plot it.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import json
# x, y = (173994.1578792833, 444133.60329471016) #uncomment if you lost x, y coordinates or Nominatim didn't work above :D
WfsUrl = 'https://geodata.nationaalgeoregister.nl/nwbwegen/wfs?'
wfs = WebFeatureService(url=WfsUrl, version='2.0.0')
layer = list(wfs.contents)[0]
xmin, xmax, ymin, ymax = x-1000, x+350, y-1000, y+350
response = wfs.getfeature(typename=layer, bbox=(xmin, ymin, xmax, ymax))
with open('./data/Roads.gml', 'wb') as file:
    file.write(response.read())
roadsGDF = gpd.read_file('./data/Roads.gml')
print(type(roadsGDF))
roadsGDF.plot()</code></pre>
</div>
<p><img src="./images/roadsGDF.png" alt="Roads in Wageningen", width = "60%"></p>
<p>How many roads are there in the resulting GeoDataFrame (hint: <em>len()</em> or <em>.info()</em>)? Do we miss roads in the extent?</p>
<p>Load some building from another WFS service (BAG) and plot them too. How many buildings do you get? (hint: <em>len()</em>) Do you miss buildings? How can we extract missing buildings in our extent?</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">WfsUrl = 'https://geodata.nationaalgeoregister.nl/bag/wfs?'
wfs = WebFeatureService(url=WfsUrl, version='2.0.0')
layer = list(wfs.contents)[1]
xmin, xmax, ymin, ymax = x-1000, x+1000, y-1000, y+1000
response = wfs.getfeature(typename=layer, bbox=(xmin, ymin, xmax, ymax), outputFormat='application/gml+xml; version=3.2')
with open('./data/Buildings.gml', 'w') as file:
    file.write(response.read())
BuildingsGDF = gpd.read_file('./data/Buildings.gml')
print(type(BuildingsGDF))
roadlayer = roadsGDF.plot(color='grey')
roadlayer.set_xlim(xmin, xmax)
roadlayer.set_ylim(ymin, ymax)
BuildingsGDF.plot(ax=roadlayer, color='red')</code></pre>
</div>
<p><img src="./images/BuildingsAndRoads.png" alt="Buildings in Wageningen", width = "60%"></p>
<p>Let us also load the administrative parcels for this area.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">parcelsWFSUrl = 'https://geodata.nationaalgeoregister.nl/kadastralekaartv3/wfs'
parcelsWFS = WebFeatureService(url=parcelsWFSUrl, version='2.0.0')
print(list(parcelsWFS.contents))

responseParcels = parcelsWFS.getfeature(typename='kadastralekaartv3:perceel', 
                                        bbox=(xmin, ymin, xmax, ymax), 
                                        maxfeatures=100, outputFormat='json', startindex=0)
data = json.loads(responseParcels.read())
parcelsGDF = gpd.GeoDataFrame.from_features(data['features'])
parcelsGDF.plot()</code></pre>
</div>
<p><img src="./images/parcelsGDF.png" alt="Parcels in Wageningen", width = "60%"></p>
<h2 id="selecting-data">Selecting Data</h2>
<p>GeoDataFrames store rows and columns in a tabular format. To select specific rows, you can make use of the DataFrame functionality of Pandas. Inspect the content of your data:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(parcelsGDF.columns)
print(parcelsGDF.head())
print(parcelsGDF.area)</code></pre>
</div>
<p>Then based on the surface area, select parcels with a larger surface area of 100,000 m2 with the .loc method. This is equivalent to selecting rows.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(parcelsGDF.area > 100000)
largeParcelsGDF = parcelsGDF.loc[parcelsGDF.area > 100000]
largeParcelsGDF.plot()</code></pre>
</div>
<p>Columns can be selected by using an index to the name of the column.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(parcelsGDF['perceelnummer'])</code></pre>
</div>
<p>Specific rows can be selected by using .isin method on a series.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(parcelsGDF['perceelnummer'].isin(['11185', '11725']))
campusParcelsGDF = parcelsGDF[parcelsGDF['perceelnummer'].isin(['11185', '11725'])]
campusParcelsGDF.plot()</code></pre>
</div>
<p><img src="./images/CampusParcels.png" alt="Parcels at Wageningen University Campus", width = "60%"></p>
<h2 id="geometric-manipulations">Geometric Manipulations</h2>
<p>GeoDataFrames and GeoSeries have several <a href="http://geopandas.org/geometric_manipulations.html">constructive methods</a> to modify the geometry: buffer, boundary, centroid, convex hull, envelope, simplify, unary union, rotate, scale, skew and translate. When modifying the geometries in the DataFrames, it is a good practice to keep track of your geometry types and your geometry data. Have a look at the geometry types.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(type(largeParcelsGDF))
print(type(largeParcelsGDF.geometry))
print(type(largeParcelsGDF['geometry']))</code></pre>
</div>
Bind some parcels together with a union.
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">parcelsUnionGS = gpd.GeoSeries(largeParcelsGDF.unary_union)
parcelsUnionGS.plot()</code></pre>
</div>
<p><img src="./images/parcelsUnionGDF.png" alt="Unioned parcels at Wageningen University Campus", width = "60%"></p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 3</strong>: What is the geometry type of geometries in parcelsUnionGS?
</p>
</blockquote>
</div>
</div>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 4</strong>: What coordinate system does parcelsUnionGS have?
</p>
</blockquote>
</div>
</div>
There is still some holes between the parcels. Create a convex around the merged features.
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">parcelsConvexGDF = gpd.GeoDataFrame(parcelsUnionGS.convex_hull)
parcelsConvexGDF = parcelsConvexGDF.rename(columns={0:'geometry'}).set_geometry('geometry')
parcelsConvexGDF.plot()</code></pre>
</div>
<p><img src="./images/parcelsConvexGDF.png" alt="Convexed parcels at Wageningen University Campus", width = "60%"></p>
GeoPandas can perform different <a href="http://geopandas.org/set_operations.html">overlay operations</a>: intersection, union, symmetrical difference and difference. Clip the roads with convexed parcels by using intersection.
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># we need polygons instead of line features for the overlay
RoadsPolygonGDF = gpd.GeoDataFrame(roadsGDF, geometry=roadsGDF.buffer(distance=5))
RoadsPolygonGDF.plot()
# perform an intersection overlay
roadsIntersectionGDF = gpd.overlay(parcelsConvexGDF, RoadsPolygonGDF, how="intersection")
roadsIntersectionGDF.plot()</code></pre>
</div>
<p><img src="./images/roadsIntersectionGDF.png" alt="Roads at Wageningen University Campus", width = "60%"></p>
<p>The big advantage of GeoPandas is that GeoPandas allows both geometric and dataframe manipulations. For example, GeoPandas can select the roads within (and maintained by) Wageningen Municipality and calculate total road surface area.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">WageningenRoadsGDF = RoadsPolygonGDF.loc[RoadsPolygonGDF['gme_naam']=='Wageningen']
print(sum(WageningenRoadsGDF.area))
WageningenRoadsGDF.plot()</code></pre>
</div>
<p><img src="./images/WageningenRoadsGDF.png" alt="Roads within the Wageningen Municipality", width = "60%"></p>
<h2 id="visualizing-spatial-information">Visualizing spatial information</h2>
<p>There are multiple solutions to visualize your geodata: GIS software (QGIS), web platforms (leaflet/Folium) and images (matplotlib).</p>
<p>Folium uses leaflet on the backend to make webmaps. With leaflet your geodata can be easily visualized inside a webpage. <a href="https://leafletjs.com/">Leaflet</a> is the leading open-source JavaScript library for mobile-friendly interactive maps. Folium handles GeoDataFrames or JSON files as input for the interactive map. The Python script below makes a .html file in your working directory, which you can open in your preferred web browser:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import folium
campusMap = folium.Map([location.latitude, location.longitude], zoom_start=17)
BuildingsGDF.crs = {'init': 'epsg:28992'}
BuildingsGDF.to_crs({'init': 'epsg:4326'})
RoadsPolygonGDF.crs = {'init': 'epsg:28992'}
RoadsPolygonGDF.to_crs({'init': 'epsg:4326'})
campusMap.choropleth(BuildingsGDF, name='Building construction years', 
                     data=BuildingsGDF, columns=['gml_id', 'bouwjaar'], 
                     key_on='feature.properties.gml_id', fill_color='RdYlGn',
                     fill_opacity=0.7, line_opacity=0.2,legend_name='Construction year')
campusMap.choropleth(RoadsPolygonGDF)
folium.LayerControl().add_to(campusMap)
campusMap.save('./data/campusMap.html')
campusMap</code></pre>
</div>
<p><img src="./images/WageningenFoliumMapBuildingYear.png" alt="Folium map of Wageningen University Campus", width = "100%"></p>
<p>Matplotlib allows you to make good quality maps for reports or publications.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from matplotlib import pyplot as plt
# extract only buildings on and around WUR campus
WfsUrl = 'https://geodata.nationaalgeoregister.nl/bag/wfs?'
wfs = WebFeatureService(url=WfsUrl, version='2.0.0')
layer = list(wfs.contents)[1]
xmin, xmax, ymin, ymax = x-300, x+600, y-300, y+300
response = wfs.getfeature(typename=layer, bbox=(xmin, ymin, xmax, ymax), outputFormat='application/gml+xml; version=3.2')
with open('./data/WURBuildings.gml', 'w') as file:
    file.write(response.read())
BuildingsGDF = gpd.read_file('./data/WURBuildings.gml')
# create visualisation
f, ax = plt.subplots(1, figsize=(10, 5))
ax.set_title('WUR campus buildings')
ax.set_facecolor("grey")
roadlayer = RoadsPolygonGDF.plot(ax=ax, legend=True)
roadlayer.set_xlim(xmin, xmax)
roadlayer.set_ylim(ymin, ymax)
buildingslayer = BuildingsGDF.plot(ax=roadlayer, column='bouwjaar', 
                                   cmap='brg', #see https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html
                                   legend=True, 
                                   legend_kwds={'label': "Construction year",'orientation': "vertical"})</code></pre>
</div>
<p><img src="./images/WURcampusMapBuildings.png" alt="Road types at Wageningen University Campus", width = "100%"></p>
<h2 id="network-analysis">Network analysis</h2>
<p>There are a lot of Python packages available to help you with your specific spatial analysis. One package, that we could not leave out is OSMnx. <a href="https://osmnx.readthedocs.io/en/stable/">OSMnx</a> retrieves, constructs, analyzes and visualizes street networks from <a href="https://www.openstreetmap.org/search?query=Wageningen%20university#map=18/51.98528/5.66368">OpenStreetMap</a>. In short, a network analysis is quite often performed with Open Street Map data since it is globally available, has well connected networks and has multiple travel modes (walking, cycling, driving et cetera). Download the street network of Wageningen and plot it.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import osmnx as ox
city = ox.gdf_from_place('Wageningen, Netherlands')
ox.plot_shape(ox.project_gdf(city))
WageningenRoadsGraph = ox.graph_from_place('Wageningen, Netherlands', network_type='all')
ox.plot_graph(WageningenRoadsGraph, fig_height=20, fig_width=20)
ox.save_graph_shapefile(G=WageningenRoadsGraph, filename='OSMnetwork_Wageningen.shp')
gdf_nodes, gdf_edges = ox.graph_to_gdfs(G=WageningenRoadsGraph)
print(gdf_nodes.info())
print(gdf_edges.info())</code></pre>
</div>
<p><img src="./images/osmnxGraph.png" alt="Roads in Wageningen", width = "100%"></p>
<p>OSMnx can store the downloaded street network (the Graph) as a shapefile or as a GeoDataFrame. Furthermore, the main purpose is to perform a network analysis, such as a shortest path from source to target location. Let us calculate the shortest path from Wageningen campus to Wageningen city center. Is this the route you would take?</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">source = ox.get_nearest_node(WageningenRoadsGraph, (51.987817, 5.665779))
target = ox.get_nearest_node(WageningenRoadsGraph, (51.964870, 5.662409))
shortestroute = ox.nx.shortest_path(G=WageningenRoadsGraph, 
                                    source=source, target=target, weight='length')
ox.plot_graph_route(WageningenRoadsGraph, shortestroute, 
                    fig_height=20, fig_width=20)</code></pre>
</div>
<p><img src="./images/shortestPathGraph.png" alt="Shortest path from Wageningen University Campus to Wageningen City Center", width = "100%"></p>
<h1 id="what-have-we-learned">What have we learned?</h1>
<ol style="list-style-type: decimal">
<li>Creating geometries, GeoSeries and GeoDataFrames</li>
<li>Geocoding</li>
<li>Re-projecting</li>
<li>Reading and writing data</li>
<li>Reading webservices</li>
<li>Selecting data</li>
<li>Geometric manipulations</li>
<li>Geo-visualization</li>
<li>Network analysis</li>
</ol>
<h1 id="exercise-11">Exercise 11</h1>
<p>Wageningen University wants to determine the percentage of building surface area on the parcels at the campus. Can you help?</p>
<ul>
<li>Determine how much area (m2 and percentage) of the WUR campus are covered by buildings by using the <a href="https://geodata.nationaalgeoregister.nl/bag/wfs?">BAG WFS</a> (typename = bag:pand) and visualize both the buildings surface area and the campus area in a map.</li>
<li>Use the OSMNX package to extract a geometry that represents the Wageningen Campus area (use 'Wageningen University' as search name).</li>
<li>After extracting the Wageningen Campus geometry, use this as a bounding box for extracting the buildings for this area.(hint .envelope, .exterior).</li>
<li>Work with a project structure, make a main.py module that imports functions from another Python module called 'MyOwnFunctions.py'. At least in this module we expect the following three functions:</li>
</ul>
<ol style="list-style-type: decimal">
<li>GeocodePlacenameToGDF</li>
<li>BAGtoGeoDataFrame</li>
<li>CalculatePercentageArea</li>
</ol>
<ul>
<li>We expect a couple of resulting variables that are:</li>
</ul>
<ol style="list-style-type: decimal">
<li>WURbuildingsGDF =&gt; GeoDataFrame with all building geometries within the WUR campus area</li>
<li>BuildingsArea =&gt; The total surface area (m2) of all building geometries together within the WUR campus area</li>
<li>PercentageCoverage =&gt; The percentage of building coverage within the total WUR campus area</li>
</ol>
<p>Go easy on webservices! There is no need to use for loops or while statements to call web services multiple times! Upload your documented and well structured Python scripts to a GitLab repository.</p>
<p>You will be reviewed mainly on the following three tasks and expected output:</p>
<ol style="list-style-type: decimal">
<li>Functions that provide the necessary functionality for this exercise.</li>
<li>Calculate how much area (m2 and %) is building surface area for the Wageningen campus.</li>
<li>Present a nice-looking map visualization of the campus and the buildings.</li>
</ol>
<p>Optional bonus: Calculate how much area (m2 and %) is building, <u>per parcel</u>. Present result nicely summarized in one table as also in a nice-looking map visualization of the relevant parcels and their (partial) coverage by buildings. For this you will need the <a href="https://geodata.nationaalgeoregister.nl/kadastralekaartv3/wfs">Kadaster WFS</a> (typename = kadastralekaartv3:perceel).</p>
Hint: If you need some help how to make functions or how to import modules, have a look at the code in the Python refresher or in the cheat sheets mentioned in the Python refresher.
</div>
</div>
</div>
<div id="push">

</div>
<div id="footer">
<div class="container">
<p class="text-muted" id="credit">
Styled with <a href="https://github.com/jimhester/knitrBootstrap">knitrBootstrap</a>
</p>
</div>
</div>
<link rel="stylesheet" id="theme" href="https://netdna.bootstrapcdn.com/bootswatch/3.0.0/simplex/bootstrap.min.css" media="screen"></link><link rel="stylesheet" id="highlight" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/tomorrow-night-bright.min.css" media="screen"></link>
</div>
</body>
</html>
