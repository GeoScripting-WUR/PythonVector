<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Jan Verbesselt, Jorge Mendes de Jesus, Aldo Bergsma, Dainius Masiliunas, David Swinkels, Judith Verstegen, Corné Vreugdenhil" />
  <title>Tutorial 9: Vector data handling with Python</title>
  <style type="text/css">
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

  <!-- bootstrap -->
  <!--<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet"  id="style">-->
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

  <!-- highlight.js -->
  <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css" rel="stylesheet" id="code-style">-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
  <script>
  hljs.LANGUAGES.r=function(a){var b="([a-zA-Z]|\\.[a-zA-Z.])[a-zA-Z0-9._]*";return{c:[a.HCM,{b:b,l:b,k:{keyword:"function if in break next repeat else for return switch while try tryCatch|10 stop warning require library attach detach source setMethod setGeneric setGroupGeneric setClass ...|10",literal:"NULL NA TRUE FALSE T F Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10"},r:0},{cN:"number",b:"0[xX][0-9a-fA-F]+[Li]?\\b",r:0},{cN:"number",b:"\\d+(?:[eE][+\\-]?\\d*)?L\\b",r:0},{cN:"number",b:"\\d+\\.(?!\\d)(?:i\\b)?",r:0},{cN:"number",b:"\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[a.BE],r:0},{cN:"string",b:"'",e:"'",c:[a.BE],r:0}]}}(hljs); </script>
  <!--<script type="text/javascript", src="https://yandex.st/highlightjs/7.3/languages/r.min.js"></script>-->

  <!-- Manific Popup -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/0.8.9/jquery.magnific-popup.min.js"></script>

  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script defer="defer">
  // Function to generate the dynamic table of contents
  jQuery.fn.generate_TOC = function () {
    var base = $(this[0]);

    var selectors = ['h1', 'h2', 'h3', 'h4'];

    var last_ptr = [{}, {}, {}, {}];

    var anchors = {};

    generate_anchor = function (text) {
      var test = text.replace(/\W/g, '_');

      while(test in anchors){
        //if no suffix, add one
        if(test.match(/_\d+$/) === null){
          test = test + "_2";
        }
        //else generate unique id for duplicates by adding one to the suffix
        else {
          test = test.replace(/_(\d+)$/, function(match, number){ var num=+number+1; return("_" + num) });
        }
      }
      anchors[test]=1;
      return(test);
    }

    $(selectors.join(',')).filter(function(index) { return $(this).parent().attr("id") != 'header'; }).each(function () {

      var heading = $(this);
      var idx = selectors.indexOf(heading.prop('tagName').toLowerCase());
      var itr = 0;

      while (itr <= idx) {
        if (jQuery.isEmptyObject(last_ptr[itr])) {
          last_ptr[itr] = $('<ul>').addClass('nav');
          if (itr === 0) {
            base.append(last_ptr[itr])
          } else {
            if(last_ptr[itr-1].children('li').length === 0){
              last_ptr[itr-1].append(last_ptr[itr]);
            }
            else {
              last_ptr[itr - 1].children('li').last().append(last_ptr[itr]);
            }
          }
        }
        itr++;
      }
      var anchor = generate_anchor(heading.text());
      heading.attr('id', anchor);
      var a = $('<a>')
      .text(heading.text())
      .attr('href', '#' + anchor);

    var li = $('<li>')
      .append(a);

    last_ptr[idx].append(li);
    for (i = idx + 1; i < last_ptr.length; i++) {
      last_ptr[i] = {};
    }
    });
  }
  /* run scripts when document is ready */
  $(function() {
    "use strict";

    var $window = $(window);
    var $body = $(document.body);

    /* size of thumbnails */

    var hidden_types = ['source']
    var output_types = ['output', 'message', 'warning', 'error']

    /* style tables */
    $('table').addClass('table table-striped table-bordered table-hover table-condensed');

    $('pre code').each(function(i, e) {
      hljs.highlightBlock(e);
    });

    /* Magnific Popup */
    $(".thumbnail").each(function(){
      $(this).magnificPopup({
        disableOn: 768,
        closeOnContentClick: true,

        type: 'image',
        items: {
          src: $(this).find('img').attr('src'),
        }
      });
    });

    function toggle_block(obj, show) {
      var span = obj.find('span');
      if(show === true){
        span.removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
        obj.next('pre').slideDown();
      }
      else {
        span.removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
        obj.next('pre').slideUp();
      }
    }

    function toggle_thumbnails(imgs, show){
      if(show === true){
        imgs.parents().show()
        imgs.slideDown();
      }
      else {
        imgs.slideUp(400, function(){ $(this).parent().hide(); });
      }
    }

    function global_toggle(obj){
      var type = obj.attr('type');
      var show = !obj.parent('li').hasClass('active');
      if(show === true){
        obj.parent('li').addClass('active');
      }
      else{
        obj.parent('li').removeClass('active');
      }
      if(type == 'figure'){
        toggle_thumbnails($('.thumbnail img'), show);
      }
      else {
        $('.toggle.' + type).each(function() { toggle_block($(this), show); });
      }
    }

    /* onclick toggle next code block */
    $('.toggle').click(function() {
      var span = $(this).find('span');
      toggle_block($(this), !span.hasClass('glyphicon-chevron-down'));
      return false
    })

    // global toggles
    $('.toggle-global').click(function(){
      var type = $(this).attr('type');
      if(type === 'all-source'){
          $('li a.source').each(function() {
            global_toggle($(this));
          });
        }
      else if(type === 'all-output'){
        $.each(output_types, function(i, val){
          console.log(val);
          global_toggle($('li a.' + val));
        });
      }
      else {
        console.log($(this));
        global_toggle($(this));
      }
      return false;
    });
    /* table of contents */
    if($(['h1', 'h2', 'h3', 'h4'].join(',')).length > 0){
      $('body > #wrap > .container > .row').append('<div class="col-md-2"><div id="toc" class="well sidebar sidenav affix hidden-print"/></div>');
      $('#toc').generate_TOC();
    }

    $.each(hidden_types, function(i, type) {
      $('li[type=' + type + ']').each(function(){ global_toggle($(this)); });
    });

    /* remove paragraphs with no content */
    $('p:empty').remove();

    $body.scrollspy({
      target: '.sidebar',
    });

    /* theme switch */
    $('.theme-switch').click(function(){
      var css = $('link[title=' + $(this).attr('title') + ']');
      $('#theme[rel=stylesheet]').attr('href', css.attr('href'));
      $('.theme-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });
    /* code style switch */ //TODO use same function for both of these?
    $('.highlight-switch').click(function(){
      var css = $('link[title="' + $(this).attr('title') + '"]');
      $('#highlight[rel=stylesheet]').attr('href', css.attr('href'));
      $('.highlight-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });

    //TODO refresh on show/hide
    $window.on('load', function () {
      $body.scrollspy('refresh');
    })

  });

  </script>
  <style>
  /* Knitr_bootstrap styles */
  #header {
    display: none !important;
    visibility: hidden !important;
  }
  #wrap .container-fluid {
    padding: 0;
    overflow: hidden;
  }
  .toggle{
    text-transform: capitalize;
  }

  .toggle-global{
    text-transform: capitalize;
  }

  /* Sticky footer styles */
  * {
    margin:0;
  }
  html,
  body {
      height: 100%;
      padding:0 !important;
      /* The html and body elements cannot have any padding or margin. */
      /*overflow-x: hidden;*/
  }

  /* Wrapper for page content to push down footer */
  #wrap {
      min-height: 100%;
      height: auto !important;
      height: 100%;
      /* Negative indent footer by it's height */
      margin: 0 auto -120px;
  }

  /* Set the fixed height of the footer here */
  #push,
  #footer {
      height: 120px;
  }

  #footer {
    text-align: center;
  }

  /* Top level subheader elements.  These are the first nested items underneath a header element. */
  .header li {
    font-size: 20px;
  }

  /* Makes the font smaller for all subheader elements. */
  .sub-header li {
      font-size: 12px;
  }

  button.thumbnails {
    margin-left:0px;
  }

  /*
   * Side navigation
   *
   * Scrollspy and affixed enhanced navigation to highlight sections and secondary
   * sections of docs content.
   */

  /* By default it's not affixed in mobile views, so undo that */
  .sidebar.affix {
    position: static;
  }

  /* First level of nav */
  .sidenav {
    margin-top: 30px;
    margin-bottom: 30px;
    padding-top:    10px;
    padding-bottom: 10px;
    border-radius: 5px;
  }

  /* All levels of nav */
  .sidebar .nav > li > a {
    display: block;
    padding: 5px 20px;
  }
  .sidebar .nav > li > a:hover,
  .sidebar .nav > li > a:focus {
    text-decoration: none;
    border-right: 1px solid;
  }
  .sidebar .nav > .active > a,
  .sidebar .nav > .active:hover > a,
  .sidebar .nav > .active:focus > a {
    font-weight: bold;
    background-color: transparent;
    border-right: 1px solid;
  }

  /* Nav: second level (shown on .active) */
  .sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    margin-bottom: 8px;
  }
  .sidebar .nav .nav > li > a {
    padding-top:    3px;
    padding-bottom: 3px;
    padding-left: 30px;
    font-size: 90%;
  }

  .sidebar .nav .nav .nav > li > a {
    padding-left: 40px;
  }
  .sidebar .nav .nav .nav .nav > li > a {
    padding-left: 50px;
  }

  /* Show and affix the side nav when space allows it */
  @media screen and (min-width: 992px) {
    .sidebar .nav > .active > ul {
      display: block;
    }
    /* Widen the fixed sidebar */
    .sidebar.affix,
    .sidebar.affix-bottom {
      width: 213px;
    }
    .sidebar.affix-top,
    .sidebar.affix {
      position: fixed; /* Undo the static from mobile first approach */
      top: 30px;
    }
    .sidebar.affix-bottom {
      position: absolute; /* Undo the static from mobile first approach */
    }
    .sidebar.affix-bottom .sidenav,
    .sidebar.affix .sidenav {
      margin-top: 0;
      margin-bottom: 0;
    }
  }
  @media screen and (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .sidebar.affix-bottom,
    .sidebar.affix {
      width: 263px;
    }
  }

  #toc {
    padding: 10px 0px;
    margin:0;
    border:0;
  }


  .panel pre {
    margin: 0;
    padding: 0;
    border: 0;
  }
  button + pre {
    margin: 0;
    padding: 0;
  }
  pre code {
    border-radius: 0;
  }
  /* Magnific Popup CSS */
  .mfp-bg {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1042;
    overflow: hidden;
    position: fixed;
    background: #0b0b0b;
    opacity: 0.8;
    filter: alpha(opacity=80); }

  .mfp-wrap {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1043;
    position: fixed;
    outline: none !important;
    -webkit-backface-visibility: hidden; }

  .mfp-container {
    text-align: center;
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
    padding: 0 8px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box; }

  .mfp-container:before {
    content: '';
    display: inline-block;
    height: 100%;
    vertical-align: middle; }

  .mfp-align-top .mfp-container:before {
    display: none; }

  .mfp-content {
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin: 0 auto;
    text-align: left;
    z-index: 1045; }

  .mfp-inline-holder .mfp-content,
  .mfp-ajax-holder .mfp-content {
    width: 100%;
    cursor: auto; }

  .mfp-ajax-cur {
    cursor: progress; }

  .mfp-zoom-out-cur,
  .mfp-zoom-out-cur .mfp-image-holder .mfp-close {
    cursor: -moz-zoom-out;
    cursor: -webkit-zoom-out;
    cursor: zoom-out; }

  .mfp-zoom {
    cursor: pointer;
    cursor: -webkit-zoom-in;
    cursor: -moz-zoom-in;
    cursor: zoom-in; }

  .mfp-auto-cursor .mfp-content {
    cursor: auto; }

  .mfp-close,
  .mfp-arrow,
  .mfp-preloader,
  .mfp-counter {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none; }

  .mfp-loading.mfp-figure {
    display: none; }

  .mfp-hide {
    display: none !important; }

  .mfp-preloader {
    color: #cccccc;
    position: absolute;
    top: 50%;
    width: auto;
    text-align: center;
    margin-top: -0.8em;
    left: 8px;
    right: 8px;
    z-index: 1044; }

  .mfp-preloader a {
    color: #cccccc; }

  .mfp-preloader a:hover {
    color: white; }

  .mfp-s-ready .mfp-preloader {
    display: none; }

  .mfp-s-error .mfp-content {
    display: none; }

  button.mfp-close,
  button.mfp-arrow {
    overflow: visible;
    cursor: pointer;
    background: transparent;
    border: 0;
    -webkit-appearance: none;
    display: block;
    padding: 0;
    z-index: 1046;
    -webkit-box-shadow: none;
    box-shadow: none; }

  button::-moz-focus-inner {
    padding: 0;
    border: 0; }

  .mfp-close {
    width: 44px;
    height: 44px;
    line-height: 44px;
    position: absolute;
    right: 0;
    top: 0;
    text-decoration: none;
    text-align: center;
    opacity: 0.65;
    padding: 0 0 18px 10px;
    color: white;
    font-style: normal;
    font-size: 28px;
    font-family: Arial, Baskerville, monospace; }
    .mfp-close:hover, .mfp-close:focus {
      opacity: 1; }
    .mfp-close:active {
      top: 1px; }

  .mfp-close-btn-in .mfp-close {
    color: #333333; }

  .mfp-image-holder .mfp-close,
  .mfp-iframe-holder .mfp-close {
    color: white;
    right: -6px;
    text-align: right;
    padding-right: 6px;
    width: 100%; }

  .mfp-counter {
    position: absolute;
    top: 0;
    right: 0;
    color: #cccccc;
    font-size: 12px;
    line-height: 18px; }

  .mfp-arrow {
    position: absolute;
    opacity: 0.65;
    margin: 0;
    top: 50%;
    margin-top: -55px;
    padding: 0;
    width: 90px;
    height: 110px;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }

  .mfp-arrow:active {
    margin-top: -54px; }

  .mfp-arrow:hover,
  .mfp-arrow:focus {
    opacity: 1; }

  .mfp-arrow:before, .mfp-arrow:after,
  .mfp-arrow .mfp-b,
  .mfp-arrow .mfp-a {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    left: 0;
    top: 0;
    margin-top: 35px;
    margin-left: 35px;
    border: medium inset transparent; }
  .mfp-arrow:after,
  .mfp-arrow .mfp-a {
    border-top-width: 13px;
    border-bottom-width: 13px;
    top: 8px; }
  .mfp-arrow:before,
  .mfp-arrow .mfp-b {
    border-top-width: 21px;
    border-bottom-width: 21px; }

  .mfp-arrow-left {
    left: 0; }
    .mfp-arrow-left:after,
    .mfp-arrow-left .mfp-a {
      border-right: 17px solid white;
      margin-left: 31px; }
    .mfp-arrow-left:before,
    .mfp-arrow-left .mfp-b {
      margin-left: 25px;
      border-right: 27px solid #3f3f3f; }

  .mfp-arrow-right {
    right: 0; }
    .mfp-arrow-right:after,
    .mfp-arrow-right .mfp-a {
      border-left: 17px solid white;
      margin-left: 39px; }
    .mfp-arrow-right:before,
    .mfp-arrow-right .mfp-b {
      border-left: 27px solid #3f3f3f; }

  .mfp-iframe-holder {
    padding-top: 40px;
    padding-bottom: 40px; }

  .mfp-iframe-holder .mfp-content {
    line-height: 0;
    width: 100%;
    max-width: 900px; }

  .mfp-iframe-scaler {
    width: 100%;
    height: 0;
    overflow: hidden;
    padding-top: 56.25%; }

  .mfp-iframe-scaler iframe {
    position: absolute;
    display: block;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: black; }

  .mfp-iframe-holder .mfp-close {
    top: -40px; }

  /* Main image in popup */
  img.mfp-img {
    width: auto;
    max-width: 100%;
    height: auto;
    display: block;
    line-height: 0;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    padding: 40px 0 40px;
    margin: 0 auto; }

  /* The shadow behind the image */
  .mfp-figure:after {
    content: '';
    position: absolute;
    left: 0;
    top: 40px;
    bottom: 40px;
    display: block;
    right: 0;
    width: auto;
    height: auto;
    z-index: -1;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: #444444; }

  .mfp-figure {
    line-height: 0; }

  .mfp-bottom-bar {
    margin-top: -36px;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    cursor: auto; }

  .mfp-title {
    text-align: left;
    line-height: 18px;
    color: #f3f3f3;
    word-wrap: break-word;
    padding-right: 36px; }

  .mfp-figure small {
    color: #bdbdbd;
    display: block;
    font-size: 12px;
    line-height: 14px; }

  .mfp-image-holder .mfp-content {
    max-width: 100%; }

  .mfp-gallery .mfp-image-holder .mfp-figure {
    cursor: pointer; }

  @media screen and (max-width: 800px) and (orientation: landscape), screen and (max-height: 300px) {
    /**
     * Remove all paddings around the image on small screen
     */
    .mfp-img-mobile .mfp-image-holder {
      padding-left: 0;
      padding-right: 0; }

    .mfp-img-mobile img.mfp-img {
      padding: 0; }

    /* The shadow behind the image */
    .mfp-img-mobile .mfp-figure:after {
      top: 0;
      bottom: 0; }

    .mfp-img-mobile .mfp-bottom-bar {
      background: rgba(0, 0, 0, 0.6);
      bottom: 0;
      margin: 0;
      top: auto;
      padding: 3px 5px;
      position: fixed;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box; }

    .mfp-img-mobile .mfp-bottom-bar:empty {
      padding: 0; }

    .mfp-img-mobile .mfp-counter {
      right: 5px;
      top: 3px; }

    .mfp-img-mobile .mfp-close {
      top: 0;
      right: 0;
      width: 35px;
      height: 35px;
      line-height: 35px;
      background: rgba(0, 0, 0, 0.6);
      position: fixed;
      text-align: center;
      padding: 0; }

    .mfp-img-mobile .mfp-figure small {
      display: inline;
      margin-left: 5px; } }
  @media all and (max-width: 900px) {
    .mfp-arrow {
      -webkit-transform: scale(0.75);
      transform: scale(0.75); }

    .mfp-arrow-left {
      -webkit-transform-origin: 0;
      transform-origin: 0; }

    .mfp-arrow-right {
      -webkit-transform-origin: 100%;
      transform-origin: 100%; }

    .mfp-container {
      padding-left: 6px;
      padding-right: 6px; } }
  .mfp-ie7 .mfp-img {
    padding: 0; }
  .mfp-ie7 .mfp-bottom-bar {
    width: 600px;
    left: 50%;
    margin-left: -300px;
    margin-top: 5px;
    padding-bottom: 5px; }
  .mfp-ie7 .mfp-container {
    padding: 0; }
  .mfp-ie7 .mfp-content {
    padding-top: 44px; }
  .mfp-ie7 .mfp-close {
    top: 0;
    right: 0;
    padding-top: 0; }

  //Magnific overrides
  .mfp-image img{
    background: white;
  }
  .mfp-figure:after {
    background: white;
  }

  /*
   * Off Canvas navbar toggle right
   * --------------------------------------------------
   */

  @media screen and (max-width: 768px) {
    .row-offcanvas .collapsing {
    -webkit-transition: none 0;
      -moz-transition: none 0;
      transition: none 0;
    }
   .row-offcanvas .navbar {
    position: absolute;
    z-index: 2;
      right:0;
      height:100%;
      width:55px;
      border:0;
      background-color:transparent;
    }
    .row-offcanvas .navbar-toggle {
      margin-right: 5px;
      margin-left: 5px;
    }
    .row-offcanvas {
      position: relative;
    }
    .row-offcanvas-right.active .navbar {
    position: absolute;
    z-index: 2;
      right: -28.4%;
      width:40%;
      background-color:#eee;
      border:0 solid #ddd;
      border-left-width:1px;
    }
    .row-offcanvas-right.active {
      left: -30%;
    }
    .row-offcanvas-right.active .navbar-collapse {
      position: relative;
      width: 100%;
    }
    .row-offcanvas .content {
    /*width:calc(100% - 60px);*/
    }
  }
  </style>
</head>
<body>
<title>
Tutorial 9: Vector data handling with Python
</title>
<div id="wrap">
<div class="container">
<div class="row row-offcanvas row-offcanvas-right">
<div class="contents col-xs-12 col-md-10">
<style type="text/css">
body {max-width: none;}
a:visited {color: #91170a;}
</style>
<h1 id="wur-geoscripting"><a
href="https://geoscripting-wur.github.io/">WUR Geoscripting</a>
<img src="https://www.wur.nl/upload/854757ab-168f-46d7-b415-f8b501eebaa5_WUR_RGB_standard_2021-site.svg" alt="WUR logo" style="height: 35px;"/></h1>
<h1 id="week-3-tutorial-9-vector-data-handling-with-python">Week 3,
Tutorial 9: Vector data handling with Python</h1>
<h2 id="introduction">Introduction</h2>
<p>Today we will explore a variety of Python packages for vector data
handling:</p>
<ul>
<li><a href="https://pypi.org/project/GDAL/">GDAL</a>, the backbone of
spatial data processing in Python (and R) with high performance</li>
<li><a href="https://shapely.readthedocs.io/en/stable/">Shapely</a> for
geometric operations</li>
<li><a href="http://geopandas.org/">GeoPandas</a> for exploratory vector
data analysis, based on <a href="http://pandas.pydata.org/">Pandas</a>
for dataframes and data analysis</li>
<li><a href="https://github.com/jswhit/pyproj">pyproj</a> for
re-projecting</li>
<li><a href="https://fiona.readthedocs.io/en/latest/">Fiona</a> for
geodata access and conversions</li>
<li><a href="https://osmnx.readthedocs.io/en/stable/">osmnx</a> for
network analysis</li>
</ul>
<h2 id="learning-objectives">Learning objectives</h2>
<ul>
<li>Know how to create a point dataset in Python</li>
<li>Be able to write spatial vector formats to disk</li>
<li>Be able to read spatial vector formats from web services and
files</li>
<li>Know how to apply basic operations on vector data, such as buffers
and shortest-path algorithms</li>
<li>Be able to plot spatial vector data with Matplotlib</li>
</ul>
<h2 id="setting-up-the-python-environment">Setting up the Python
Environment</h2>
<p>Make a folder structure for this tutorial:</p>
<div class="row">
<button class="source bash toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> bash source
</button>
<pre style=""><code class="source bash">cd ~/Documents/
mkdir PythonVector #or give the directory a name to your liking
cd ./PythonVector
mkdir data
mkdir output</code></pre>
</div>
<p>The <code>conda</code> environment we are using today contains more
(and larger) packages than yesterday, but the process we use to create
and activat it is the same. Create a text file, (re)name it (to)
<code>vector.yaml</code>, and copy the following content into the
file:</p>
<pre><code>name: vector
dependencies:
  - python
  - numpy
  - matplotlib
  - spyder
  - gdal
  - shapely
  - pandas
  - geopandas
  - fiona
  - owslib
  - folium
  - osmnx
  - contextily</code></pre>
<p>Now, create the environment with:</p>
<div class="row">
<button class="source bash toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> bash source
</button>
<pre style=""><code class="source bash">mamba env create --file vector.yaml</code></pre>
</div>
<p>Activate the environment, open Spyder, create a script in the root
folder and start coding.</p>
<h1 id="vector-geometries-and-python">Vector Geometries and Python</h1>
<p>At the backbone of spatial data processing in Python is GDAL. GDAL
means Geospatial Data Abstraction Library, it is a ‘translator library’
for raster and vector geospatial data. Although the overarching package
is called GDAL, the term is mostly used for the raster handling part.
The vector handling part of the GDAL package is called OGR.</p>
<p>In this tutorial, we will not work much with OGR separately. However,
it is at the basis of many other packages. Therefore, to understand
object structures in these packages, it is convenient to know how
various objects in OGR are related to each other: * When you open a file
(e.g. shapefile), you have a DataSource object * A Data source can have
one or more Layer objects * A Layer can have one or more Feature objects
* Features have Geometry and Attribute objects</p>
<p><img src="./images/ogr_structure.png" alt="OGR class structure, source: Garrard, 2016, Geoprocessing with Python" width = "70%"></p>
<p>WKT (<a href="https://en.wikipedia.org/wiki/Well-known_text">Well
Known Text</a>) is a markup language that describes spatial information
in a clean text format. WKT can represent the following distinct
(OGC-defined) vector objects:</p>
<ul>
<li>Geometry primitives (single entity, basic types):
<ul>
<li>Point</li>
<li>Line (formally known as a LineString)</li>
<li>Polygon</li>
</ul></li>
<li>Multipart geometries, homogeneous entity collections:
<ul>
<li>Multi-Point</li>
<li>Multi-Line (MultiLineString)</li>
<li>Multi-Polygon</li>
</ul></li>
<li>GeometryCollection:
<ul>
<li>A combination of any of the above</li>
</ul></li>
<li>Other, less used objects</li>
</ul>
<p>Geometric objects in any Python package (e.g. GDAL, shapely) are
usually based on the geometries that can be represented in WKT strings.
As such, it is useful to know how to write geometries in WKT; then you
do not need to learn the specific way of each individual Python package.
GDAL (OGR) example:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from osgeo import ogr

# Define the WKT string
wktstring = "POINT (1120351.5712494177 741921.4223245403)"

# Transform to a GDAL (OGR) object
point = ogr.CreateGeometryFromWkt(wktstring)

# Get properties
print(type(point))
print("%d,%d" % (point.GetX(), point.GetY()))</code></pre>
</div>
<p>A Shapely example, where we create a point from WKT or make the Point
object directly:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from shapely.geometry import Point
from shapely.wkt import loads

# Create point from WKT string 
wktstring = 'POINT(173994.1578792833 444133.6032947102)'
wageningen_campus = loads(wktstring)
print(type(wageningen_campus))

# Point directly
wageningen_campus = Point([173994.1578792833, 444133.60329471016])
print(type(wageningen_campus))</code></pre>
</div>
<p>There is an equivalent in binary format called WKB, easier for
computers to process and more efficient for data transfer.</p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 1</strong>: What does WKB mean? (hint: think about WKT)
</p>
</blockquote>
</div>
</div>
<h1 id="geopandas-geoseries-and-geodataframes">Geopandas: GeoSeries and
GeoDataFrames</h1>
<p>GeoPandas strives to make vector processing in Python easier and has
many functions available for exploratory vector data analysis. GeoPandas
is based on Pandas. Pandas has two main data structures: the
<code>Series</code> and the <code>DataFrame</code>. Correspondingly,
GeoPandas has two main data structures: the <code>GeoSeries</code> and
the <code>GeoDataFrame</code>.</p>
<p>A <code>GeoSeries</code> is a vector of features, where each feature
contains: 1) an index, and 2) a geometry. The latter is a
<code>shapely.geometry</code> object, and therefore inherits attributes
and methods from shapely geometries, such as area, bounds, distance,
etc. Finally, a <code>GeoSeries</code> can contain a coordinate
reference system (crs). GeoPandas functions, such as buffering, can be
applied to <code>GeoSeries</code>:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import geopandas as gpd
from shapely.wkt import loads

# Define a point
wktstring = 'POINT(173994.1578792833 444133.6032947102)'

# Convert to a GeoSeries
gs = gpd.GeoSeries([loads(wktstring)])

# Inspect the properties
print(type(gs), len(gs))

# Specify the projection
gs.crs = "EPSG:28992" 

# We can now apply a function
# As an example, we add a buffer of 100 m
gs_buffer = gs.buffer(100)

# Inspect the results
print(gs.geometry)
print(gs_buffer.geometry)</code></pre>
</div>
<p>A <code>GeoDataFrame</code> is a tabular data structure with multiple
columns, where one column is a <code>GeoSeries</code>.
<code>GeoDataFrames</code> can be loaded from a file, created with data
or loaded from a Pandas <code>DataFrame</code>. A Pandas
<code>DataFrame</code> is, just like the structured NumPy array you
learned about in the previous tutorial, a dataframe equivalent of R in
Python.</p>
<p>A Pandas <code>DataFrame</code> plus a list of shapely geometries can
be converted into a <code>GeoSeries</code> or directly to a
<code>GeoDataFrame</code>.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import pandas as pd

# Create some data, with three points, a, b, and c.
data = {'name': ['a', 'b', 'c'],
        'x': [173994.1578792833, 173974.1578792833, 173910.1578792833],
        'y': [444135.6032947102, 444186.6032947102, 444111.6032947102]}

# Turn the data into a Pandas DataFrame (column names are extracted automatically)
df = pd.DataFrame(data)

# Inspect the DataFrame
print(df.head)

# Use the coordinates to make shapely Point geometries
geometry = [Point(xy) for xy in zip(df['x'], df['y'])]

# Pandas DataFrame and shapely Points can together become a GeoPandas GeoDataFrame
# Note that we specify the CRS (projection) directly while reading to GDF
wageningenGDF = gpd.GeoDataFrame(df, geometry=geometry, crs="EPSG:28992") 

# Inspect wageningenGDF
print(type(wageningenGDF), len(wageningenGDF))</code></pre>
</div>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 2</strong>: What is the difference between a GeoSeries
and a GeoDataFrame?
</p>
</blockquote>
</div>
</div>
<p>Geopandas provides a high-level interface to the Matplotlib library
(see previous tutorial) for visualization. Vector data can simply be
mapped by using the <code>plot()</code> method on a
<code>GeoSeries</code> or <code>GeoDataFrame</code>. Several other
arguments to customize the plot can still be used. Note that the aspect
of the axes (see previous tutorial) is set to equal automatically when
using Geopandas plot, i.e. the horizontal and vertical scale are
automatically made the same.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from matplotlib import pyplot as plt

# Plotting a map of the GeoDataFrame directly
wageningenGDF.plot(marker='*', color='green', markersize=50)</code></pre>
</div>
<p><img src="./images/wageningenGDF.png" alt="Landmarks in Wageningen" width = "60%"></p>
<!-- This part has been removed in 2021/2022 to make space for more explanation on geometries
## Geocoding

Geocoding is the practice of locating the coordinates of addresses, cities, countries, and landmarks across the globe. Python has GeoPy to perform geocoding. GeoPy has a lot of [geocoders available](https://geopy.readthedocs.io/en/stable/) from Bing, Google, HERE, TomTom, MapBox and others. Often you need to have an API key to use the geocoders, which is used by the provider to limit the amount of requests to be able to keep the geocoding service running for everyone. Some geocoders are publicly available, such as Nominatim. Nominatim is made and used by OpenStreetMap. Paste the code below in Spyder and run the geocoder:

<div class="row"><button class="source Python toggle btn btn-xs btn-primary"><span class="glyphicon glyphicon-chevron-down"></span> Python source</button><pre style=""><code class="source python">from geopy.geocoders import Nominatim
geolocator = Nominatim(user_agent="specify_random_user_agent")
location = geolocator.geocode("Wageningen University")
print((location.latitude, location.longitude))
# It should print two coordinates: (lat: 51.98527485, lon:5.66370505205543)</code></pre></div>

Try to locate the coordinates of your own house. -->
<h1 id="re-projecting">Re-projecting</h1>
<!-- 
From the geocoder you got a latitude and longitude. On the web it is very common to use latitude and longitude in [WGS84 geographic coordinate system](http://spatialreference.org/ref/epsg/wgs-84). In local projects often projected coordinate systems are required to perform accurate geometric calculations. PyProj reprojects your coordinates from any input projection to an output projection. Use PyProj to do a simple conversion on a coordinate pair:

<div class="row"><button class="source Python toggle btn btn-xs btn-primary"><span class="glyphicon glyphicon-chevron-down"></span> Python source</button><pre style=""><code class="source python">from pyproj import Transformer
geolocator = Nominatim(user_agent="specify_random_user_agent")
location = geolocator.geocode("Wageningen University")
x, y = Transformer.from_crs(4326, 28992).transform(location.latitude, location.longitude) #mind swap in axis order!
print([x, y]) # always inspect results of your data handling, in this case double-check the coordinates due to potential swap in axis order.
</code></pre></div>
-->
<p>An important step in the pre-processing of geodata is to get all
datasets in a projection that suits the analysis to be performed.
GeoPandas uses PyProj in the backend to reproject the geometry of the
GeoDataFrame. Here is an example of how to reproject the
<code>wageningenGDF</code> <code>GeoDataFrame</code> we created earlier
from Dutch RD New (EPSG:28992) to WGS84 (EPSG:4326):</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Check the current crs
print(wageningenGDF.crs)

# Re-project the points to WGS84
wageningenGDF = wageningenGDF.to_crs('EPSG:4326')

# Check the crs again to see if the changes were succesful
print(wageningenGDF.crs)</code></pre>
</div>
<h1 id="writing-and-reading-files">Writing and Reading Files</h1>
<p>GeoPandas uses Fiona for file access, while Fiona, in its turn,
builds on GDAL/OGR. Fiona has drivers for:</p>
<ul>
<li>Open formats such as GeoJSON and GPX</li>
<li>ESRI formats such as shapefiles and OpenFileGDB</li>
<li>Other formats such as MapInfo and DGN</li>
</ul>
<p>But Fiona lacks some other popular file formats:</p>
<ul>
<li>Open formats such as <a
href="https://github.com/Toblerity/Fiona/issues/97">KML</a> or <a
href="https://github.com/Toblerity/Fiona/pull/96">GML</a> based on the
XML format. Solution: <a
href="https://docs.python.org/3/library/xml.etree.elementtree.html">xml.etree.ElementTree</a>.</li>
<li>Databases such as PostgreSQL. Solution: <a
href="https://pypi.org/project/psycopg2/">psycopg2</a>.</li>
<li>Webservices such as Web Feature Service [WFS] or Web Map Service
[WMS]. Solution: <a
href="https://geopython.github.io/OWSLib/">OWSLib</a>.</li>
<li>Columnar formats, such as CSV or xls. Solution: Pandas can read <a
href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">csv</a>
or <a
href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_excel.html">excel</a>
columns.</li>
</ul>
<p>If none of these packages are helpful to access your files, <a
href="http://www.gdal.org/ogr_formats.html">OGR might still be able to
help</a>.</p>
<p>A <code>GeoDataFrame</code> can be written directly to a GeoJSON file
or a shapefile. <a href="http://switchfromshapefile.org/">GeoJSON is a
recommended format</a> to use for geographic data in WGS84 coordinate
system since JSON dictionaries are easy to read and use on the web, and
GeoJSON is supported in popular GIS software. <a
href="http://geojson.org/">GeoJSON</a> is a standard format to encode
Geographic data structures in a dictionary. We assume that you are
working in the main repository in which you have a data repository.
Write some files to a GeoJSON and shapefile:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Save to disk
wageningenGDF.to_file(filename='data/wageningenPOI.geojson', driver='GeoJSON')
wageningenGDF.to_file(filename='data/wageningenPOI.shp', driver='ESRI Shapefile')</code></pre>
</div>
<p>Reading files is just as intuitive:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Read from disk
jsonGDF = gpd.read_file('data/wageningenPOI.geojson')
shpGDF = gpd.read_file('data/wageningenPOI.shp')</code></pre>
</div>
<h1 id="reading-from-webservices">Reading from webservices</h1>
<p>The web has a lot of geodata available. The OpenGeoSpatial Consortium
has specified standard protocols for geo-webservices, such as <a
href="http://www.opengeospatial.org/standards/wfs">Web Feature
Service</a> [WFS] and <a
href="http://www.opengeospatial.org/standards/wms">Web Map Service</a>
[WMS]. The standard web service protocols make it easy to access data.
For example, the following WFS provides geodata on roads and is
extracted from the Dutch national database of roads in the
Netherlands:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">from owslib.wfs import WebFeatureService

# Put the WFS url in a variable
wfsUrl = 'https://geodata.nationaalgeoregister.nl/nwbwegen/wfs?'

# Create a WFS object
wfs = WebFeatureService(url=wfsUrl, version='2.0.0')

# Get the title from the object
print(wfs.identification.title)

# Check the contents of the WFS
print(list(wfs.contents))</code></pre>
</div>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 3</strong>: How many feature sets does this WFS
contain?
</p>
</blockquote>
</div>
</div>
<p>WFS are used to make webmaps, which allow a quick view of the data
and make geodata accessible for all. If you want to do a large analysis,
it is better to download the geodata from other available repositories
and not from a WFS, as it typically has limits on the number of features
that can be requested, such as 100 or 1000 features. In the WFS above,
they are very generous with a limit of max 15.000 features per
request.</p>
<p>Load some roads from the WFS service for the campus area and plot
them:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Define center point and create bbox for study area
x, y = (173994.1578792833, 444133.60329471016)
xmin, xmax, ymin, ymax = x - 1000, x + 350, y - 1000, y + 350

# Get the features for the study area (using the wfs from the previous code block)
response = wfs.getfeature(typename=list(wfs.contents)[0], bbox=(xmin, ymin, xmax, ymax))

# Save them to disk
with open('data/Roads.gml', 'wb') as file:
    file.write(response.read())

# Read in again with GeoPandas
roadsGDF = gpd.read_file('data/Roads.gml')

# Inspect and plot to get a quick view
print(type(roadsGDF))
roadsGDF.plot()
plt.show()</code></pre>
</div>
<p><img src="./images/roadsGDF.png" alt="Roads in Wageningen" width = "60%"></p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 4</strong>: How many roads are there in the resulting
GeoDataFrame (hint: <em>len()</em> or <em>.info()</em>)? Do we miss
roads in the extent?
</p>
</blockquote>
</div>
</div>
<p>Now let’s load some buildings from another WFS service (BAG) and plot
them too.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import json

# Get the WFS of the BAG
wfsUrl = 'https://service.pdok.nl/lv/bag/wfs/v2_0'
wfs = WebFeatureService(url=wfsUrl, version='2.0.0')
layer = list(wfs.contents)[0]

# Define center point and create bbox for study area
x, y = (173994.1578792833, 444133.60329471016)
xmin, xmax, ymin, ymax = x - 500, x + 500, y - 500, y + 500

# Get the features for the study area
# notice that we now get them as json, in contrast to before
response = wfs.getfeature(typename=layer, bbox=(xmin, ymin, xmax, ymax), outputFormat='json')
data = json.loads(response.read())

# Create GeoDataFrame, without saving first
buildingsGDF = gpd.GeoDataFrame.from_features(data['features'])

# Set crs to RD New
buildingsGDF.crs = 28992

# Plot roads and buildings together
roadlayer = roadsGDF.plot(color='grey')
buildingsGDF.plot(ax=roadlayer, color='red')

# Set the limits of the x and y axis
roadlayer.set_xlim(xmin, xmax)
roadlayer.set_ylim(ymin, ymax)

# Save the figure to disk
plt.savefig('./output/BuildingsAndRoads.png')</code></pre>
</div>
<p><img src="./images/BuildingsAndRoads.png" alt="Buildings in Wageningen" width = "60%"></p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 5</strong>: How many buildings do you get? (hint:
<em>len()</em>) Do you miss buildings? How can we extract missing
buildings in our extent?
</p>
</blockquote>
</div>
</div>
<h1 id="selecting-data">Selecting data</h1>
<p>GeoDataFrames store rows and columns in a tabular format. To select
specific rows, you can make use of the DataFrame functionality of
Pandas. Inspect the content of your data:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Pandas function that returns the column labels of the DataFrame
print(buildingsGDF.columns)

# Pandas function that returns the first n rows, default n = 5
print(buildingsGDF.head())

# shape area (in the units of the projection)
print(buildingsGDF.area)</code></pre>
</div>
<p>Columns can be selected using the name of the column. Let us take a
look at the construction year (‘bouwjaar’) of the buildings.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Inspect building year column
print(buildingsGDF['bouwjaar'])</code></pre>
</div>
<p>For selecting rows, GeoPandas inherits the pandas methods for
selecting data: label based indexing with <code>loc</code>, and integer
position based indexing with <code>iloc</code>, which apply to both
<code>GeoSeries</code> and <code>GeoDataFrame</code> objects. For more
information on indexing/selecting, see the <a
href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html">pandas
documentation</a>. In addition to these, GeoPandas provides coordinate
based indexing with the <code>cx</code> indexer, which slices using a
bounding box.</p>
<p>Let us select buildings (rows) with a larger surface area than 1000
m2 with the <code>.loc</code> method.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Inspect first
print(buildingsGDF.area > 1000)

# Make the selection, select all rows with area > 1000 m2, and all columns
# Using 'label based' indexing with loc, here with a Boolean array
largeBuildingsGDF = buildingsGDF.loc[buildingsGDF.area > 1000, :]

# Plot
largeBuildingsGDF.plot()</code></pre>
</div>
<p>Similarly, the <code>isin()</code> method of Series returns a Boolean
vector that is true wherever the Series elements exist in the passed
list. This allows selecting rows where one or more columns have the
required value(s). Here we selected buildings that were under
construction (status = building phase has started (‘Bouw gestart’)).
Note that this might be outdated by the time you do this tutorial. If
you only see one building (which causes the demo to be not-so-nice), try
changing <code>Bouw gestart</code> to <code>Pand in gebruik</code> for
an overview of buildings currently in use.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Inspect first
print(buildingsGDF['status'].isin(['Bouw gestart']))

# Make the selection, the list of required values can contain more than one item
newBuildingsGDF = buildingsGDF[buildingsGDF['status'].isin(['Bouw gestart'])]

# Plot the new buildings with a basemap for reference
# based on https://geopandas.org/gallery/plotting_basemap_background.html
import contextily as ctx

# Re-project
newBuildingsGDF = newBuildingsGDF.to_crs(epsg=3857)

# Plot with 50% transparency
ax = newBuildingsGDF.plot(figsize=(10, 10), alpha=0.5, edgecolor='k')
ctx.add_basemap(ax, source=ctx.providers.Stamen.TonerLite, zoom=17)
ax.set_axis_off()</code></pre>
</div>
<p><img src="./images/NewBuildings.png" alt="Parcels at Wageningen University Campus" width = "60%"></p>
<p>(Figures shown here and in the next section may differ slightly from
the ones you obtain.)</p>
<h1 id="geometric-manipulations">Geometric manipulations</h1>
<p>GeoDataFrames and GeoSeries have several <a
href="http://geopandas.org/geometric_manipulations.html">constructive
methods</a> to modify the geometry: buffer, boundary, centroid, convex
hull, envelope, simplify, unary union, rotate, scale, skew and
translate. When modifying the geometries in the DataFrames, it is a good
practice to keep track of your geometry types and your geometry data.
Have a look at the geometry types of the roads.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(type(roadsGDF))
print(type(roadsGDF.geometry))
print(roadsGDF['geometry'])</code></pre>
</div>
<p>Let’s create a buffer around the roads to represent coverage of
roads, assuming roads have all a width of 3 meters.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Buffer of 1.5 m on both sides
roadsPolygonGDF = gpd.GeoDataFrame(roadsGDF, geometry=roadsGDF.buffer(distance=1.5)) 

# Plot
roadsPolygonGDF.plot(color='blue', edgecolor='blue')

# Check the total coverage of buffers
print(roadsPolygonGDF.area.sum())</code></pre>
</div>
<p>As we created buffers around many connected lines, we expect overlap
of these buffer features. Therefore, let us merge all road buffer
(polygon) features together in a <code>unary_union</code> and check
again for the total coverage of buffers.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Apply unary_union
# This returns a geometry, which we convert to a GeoSeries to be able to apply GeoPandas methods again
roadsUnionGS = gpd.GeoSeries(roadsPolygonGDF.unary_union)

# Check the new total coverage of buffers and compute the overlap
print(roadsUnionGS.area)
print('There was an overlap of ' + round((roadsPolygonGDF.area.sum() - roadsUnionGS.area[0]), 1).astype(str) + ' square meters.')</code></pre>
</div>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 6</strong>: What is the geometry type in RoadsUnionGS?
</p>
</blockquote>
</div>
</div>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 7</strong>: What coordinate system does RoadsUnionGS
have?
</p>
</blockquote>
</div>
</div>
GeoPandas can perform various <a
href="http://geopandas.org/set_operations.html">overlay operations</a>:
intersection, union, symmetrical difference and difference. We will clip
the roads with convexed parcels by using intersection. As an example,
let us focus on the area around the new buildings on the campus and
extract the existing roads close to them. To do so we buffer the new
buildings with 100 meter, merge them with a <code>unary_union</code> and
create a convex hull around the merged (multipolygon) buildings. Finally
we clip the roads with this single polygon.
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Re-project
newBuildingsGDF = newBuildingsGDF.to_crs(epsg=28992)

# Buffer, returns geometry, convert to GeoSeries
areaOfInterestGS = gpd.GeoSeries(newBuildingsGDF.buffer(distance=100).unary_union)

# Convex hull, returns a GeoSeries of geometries, convert to GeoDataFrame
areaOfInterestGDF = gpd.GeoDataFrame(areaOfInterestGS.convex_hull)

# Adapt metadata
areaOfInterestGDF = areaOfInterestGDF.rename(columns={0:'geometry'}).set_geometry('geometry')
areaOfInterestGDF.crs = 'EPSG:28992'

# Perform an intersection overlay
roadsIntersectionGDF = gpd.overlay(areaOfInterestGDF, roadsPolygonGDF, how="intersection")

# Plot the results
roadlayer = roadsIntersectionGDF.plot(color='grey', edgecolor='grey')
roadlayer.set_xlim(xmin, xmax)
roadlayer.set_ylim(ymin, ymax)
newBuildingsGDF.plot(ax=roadlayer, color='red')</code></pre>
</div>
<p><img src="./images/roadsIntersectionGDF.png" alt="New buildings at Wageningen University Campus and roads close to it" width = "60%"></p>
<p>In summary, the advantage of GeoPandas is that it allows both
geometric and dataframe manipulations/selections. As a result, GeoPandas
can for example select the roads within a set bounding box
<strong>and</strong> within (and maintained by) Wageningen
Municipality.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Put the WFS url in a variable
wfsUrl = 'https://geodata.nationaalgeoregister.nl/nwbwegen/wfs?'

# Create a WFS object
wfs = WebFeatureService(url=wfsUrl, version='2.0.0')

# Let's create a bit bigger bounding box for this example than last time
x, y = (173994.1578792833, 444133.60329471016)
xmin, xmax, ymin, ymax = x - 3000, x + 3000, y - 3000, y + 3000

# Get the features for the study area
response = wfs.getfeature(typename=list(wfs.contents)[0], bbox=(xmin, ymin, xmax, ymax))
roadsGDF = gpd.read_file(response)

# Select the roads within Wageningen municipality
wageningenRoadsGDF = roadsGDF.loc[roadsGDF['gme_naam'] == 'Wageningen']

# Plot
wageningenRoadsGDF.plot(edgecolor='purple')</code></pre>
</div>
<p><img src="./images/WageningenRoadsGDF.png" alt="Roads within the Wageningen Municipality" width = "60%"></p>
<h1 id="network-analysis">Network analysis</h1>
<p><a href="https://osmnx.readthedocs.io/en/stable/">OSMnx</a>
retrieves, constructs, analyzes and visualizes street networks from <a
href="https://www.openstreetmap.org/search?query=Wageningen%20university#map=18/51.98528/5.66368">OpenStreetMap</a>.
In short, a network analysis is investigating structures of relations
between entities with the use of networks and graph theory. In spatial
data, such entities are typically animals or people, and the relations
between them, for example social networks. But relations can also be
between multiple points in time for the same person, e.g. movement
processes like walking, cycling, and driving.</p>
<p>The following script downloads the street network of Wageningen from
Open Street Map as a graph, plots it, and saves it.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import osmnx as ox

# Using a geocoder to get the extent
city = ox.geocoder.geocode_to_gdf('Wageningen, Netherlands')
ox.plot.plot_footprints(ox.project_gdf(city))

# Get bike network and create graph
wageningenRoadsGraph = ox.graph.graph_from_place('Wageningen, Netherlands', network_type='bike')

# Plot and save
ox.plot.plot_graph(wageningenRoadsGraph, figsize=(10, 10), node_size=2)
ox.io.save_graph_shapefile(G=wageningenRoadsGraph, filepath='data/OSMnetwork_Wageningen.shp')

# Metadata
gdf_nodes, gdf_edges = ox.graph_to_gdfs(G=wageningenRoadsGraph)
print(gdf_nodes.info())
print(gdf_edges.info())</code></pre>
</div>
<p><img src="./images/osmnxGraph.png" alt="Roads in Wageningen" width = "50%"></p>
<p>OSMnx can store the downloaded street network (the Graph) as a
shapefile or as a <code>GeoDataFrame</code>. Furthermore, the main
purpose of the module is to perform network analyses, such as a shortest
path from source to target location. Let us calculate the shortest path
from Wageningen campus to Wageningen city center. Is this the route you
would take?</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Origin
source = ox.distance.nearest_nodes(wageningenRoadsGraph, 5.665779, 51.987817)

# Destination
target = ox.distance.nearest_nodes(wageningenRoadsGraph, 5.662409, 51.964870)

# Compute shortest path 
shortestroute = ox.distance.shortest_path(G=wageningenRoadsGraph,
                                          orig=source, 
                                          dest=target, 
                                          weight='length')

# Plot
ox.plot.plot_graph_route(wageningenRoadsGraph, shortestroute, figsize=(20, 20), 
                         route_alpha=.6, route_color='darkred',  bgcolor='#FFFFFF', 
                         node_color='#AAAAAA', edge_color='#AAAAAA',
                         route_linewidth=10, orig_dest_size=100)</code></pre>
</div>
<p><img src="./images/shortestPathGraph.png" alt="Shortest path from Wageningen University Campus to Wageningen City Center" width = "100%"></p>
<h1 id="interactive-visualization">Interactive visualization</h1>
<p>There are multiple options to visualize your geodata: GIS software
(QGIS), web maps (leaflet/Folium) and images (Matplotlib). We have
already explored some of them previously during the tutorials, but here
we will take a closer look at creating interactive web maps using
Folium.</p>
<p>Folium uses leaflet on the backend to make web maps, easily
visualized on a webpage. <a href="https://leafletjs.com/">Leaflet</a> is
an open-source JavaScript library for mobile-friendly interactive maps.
Folium handles GeoDataFrames or JSON files as input for the interactive
map. The Python script below makes a <code>.html</code> file in your
working directory, which you can open in a <a href="campusMap.html">web
browser</a>:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import folium

# Initialize the map
campusMap = folium.Map([51.98527485, 5.66370505205543], zoom_start=17)

# Re-project
buildingsGDF = buildingsGDF.to_crs(4326)
roadsPolygonGDF = roadsPolygonGDF.to_crs(4326)

# Add the buildings
folium.Choropleth(buildingsGDF, name='Building construction years',
                  data=buildingsGDF, columns=['identificatie', 'bouwjaar'],
                  key_on='feature.properties.identificatie', fill_color='RdYlGn',
                  fill_opacity=0.7, line_opacity=0.2,
                  legend_name='Construction year').add_to(campusMap)

# Add the roads
folium.GeoJson(roadsPolygonGDF).add_to(campusMap)

# Add layer control
folium.LayerControl().add_to(campusMap)

# Save (you can now open the generated .html file from the output directory)
campusMap.save('output/campusMap.html')</code></pre>
</div>
<h1 id="more-info">More info</h1>
<ul>
<li><a
href="https://github.com/jupyter/jupyter/wiki/A-gallery-of-interesting-Jupyter-Notebooks#earth-science-and-geo-spatial-data">Geo-Spatial
Notebooks</a></li>
<li><a href="https://geo-python.github.io">Geo Python course</a></li>
<li><a href="https://gdal.org/api/python.html#tutorials">GDAL
tutorials</a>
</div>
</div>
</div>
<div id="push">

</div>
<div id="footer">
<div class="container">
<p class="text-muted" id="credit">
Styled with
<a href="https://github.com/jimhester/knitrBootstrap">knitrBootstrap</a>
</p>
</div>
</div>
<link rel="stylesheet" id="theme" href="https://netdna.bootstrapcdn.com/bootswatch/3.0.0/simplex/bootstrap.min.css" media="screen"></link><link rel="stylesheet" id="highlight" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/tomorrow-night-bright.min.css" media="screen"></link>
</div></li>
</ul>
</body>
</html>
